import{r,g as u,R as le,o as I,c as oe,f as a,w as n,i as l,h as c,S as R,l as ne,x as se,T as de,B as ie,z as re,t as ue,D as me}from"./index-Bz8aCySx.js";import{a as pe,e as ce,g as fe}from"./standard-BuTz7u9m.js";import ge from"./dialogTable-DukXbKrO.js";const ve={class:"app-container standard"},_e=re({name:"Standard"}),Pe=Object.assign(_e,{setup(he){const{proxy:h}=ue(),{standard_photo:F}=h.useDict("standard_photo"),f=r({pageNum:1,pageSize:10,templateName:"",status:""}),m=r({templateName:"",status:""}),w=r([]),V=r(0),N=r(!1),g=r(!1),_=r("add"),s=r({templateName:"",standardPhotoList:[],status:"0"}),P=r(null),p=r(null),D=r({valid:!0,message:""}),L=r({templateName:[{required:!0,message:"请输入模板名称",trigger:"blur"}]}),T=e=>{f.value={pageNum:1,pageSize:10,...e},b()},O=()=>{m.value={templateName:"",status:""},T(m.value)},U=()=>{C()},z=e=>{C(e)},$=e=>{D.value=e},C=e=>{g.value=!0,e?B(e):_.value="add"},B=e=>{if(_.value="edit",s.value={...e},e.standardPhotoItem&&Array.isArray(e.standardPhotoItem)){const t=A(e.standardPhotoItem);s.value.standardPhotoList=t.map(d=>d.photoKey),E(t)}},A=e=>e.map(t=>{let d=t.shotOrder,i=t.reportOrder;return typeof d=="string"&&d!==""&&(d=Number(d)),typeof i=="string"&&i!==""&&(i=Number(i)),{...t,photoKey:t.photoKey.toString(),shotOrder:d,reportOrder:i}}),E=e=>{me(()=>{p.value&&p.value.initTableWithData(e)})},K=()=>{g.value=!1,k()},q=()=>{k()},k=()=>{var e;p.value&&p.value.resetTable(),s.value={templateName:"",standardPhotoList:[],status:"0"},D.value={valid:!0,message:""},(e=P.value)==null||e.resetFields()},W=async e=>{if(!await j(e)||!M())return!1;await Q()},j=async e=>await e.validate(d=>d),M=()=>p.value.validate()?!0:(h.$message.error(D.value.message||"请检查标准照片配置"),!1),Q=async()=>{h.$modal.loading();try{const e=p.value.getTableData(),t=G(e);await H(t),await b(),g.value=!1}catch(e){console.error("验证或请求失败:",e)}finally{h.$modal.closeLoading()}},G=e=>{const t={templateName:s.value.templateName,status:s.value.status,standardPhotoItem:e};return _.value==="edit"&&s.value.standardPhotoTemplateId&&(t.standardPhotoTemplateId=s.value.standardPhotoTemplateId),t},H=async e=>{_.value==="add"?await pe(e):await ce(e)},b=()=>{N.value=!0,fe(f.value).then(e=>{const{rows:t,total:d}=e;w.value=t,V.value=d}).finally(()=>{N.value=!1})};return b(),(e,t)=>{const d=u("el-input"),i=u("el-form-item"),S=u("el-option"),J=u("el-select"),v=u("el-button"),x=u("el-form"),y=u("el-table-column"),X=u("el-tag"),Y=u("el-table"),Z=u("pagination"),ee=u("el-switch"),te=u("el-dialog"),ae=le("loading");return I(),oe("div",ve,[a(x,{model:l(m),inline:!0},{default:n(()=>[a(i,{label:"模板名称"},{default:n(()=>[a(d,{modelValue:l(m).templateName,"onUpdate:modelValue":t[0]||(t[0]=o=>l(m).templateName=o),placeholder:"请输入模板名称",clearable:"",style:{width:"240px"}},null,8,["modelValue"])]),_:1}),a(i,{label:"状态"},{default:n(()=>[a(J,{modelValue:l(m).status,"onUpdate:modelValue":t[1]||(t[1]=o=>l(m).status=o),placeholder:"请选择状态",style:{width:"240px"},clearable:""},{default:n(()=>[a(S,{label:"启用",value:"0"}),a(S,{label:"禁用",value:"1"})]),_:1},8,["modelValue"])]),_:1}),a(i,null,{default:n(()=>[a(v,{type:"primary",icon:"Search",onClick:t[2]||(t[2]=o=>T(l(m)))},{default:n(()=>[c("查询")]),_:1}),a(v,{icon:"Refresh",onClick:O},{default:n(()=>[c("重置")]),_:1}),a(v,{type:"primary",icon:"Plus",onClick:U},{default:n(()=>[c("新增")]),_:1})]),_:1})]),_:1},8,["model"]),R((I(),ne(Y,{data:l(w)},{default:n(()=>[a(y,{type:"index",label:"序号",width:"50",align:"center"}),a(y,{prop:"templateName",label:"模板名称",align:"center"}),a(y,{prop:"status",label:"状态",align:"center"},{default:n(({row:o})=>[a(X,{type:o.status==="0"?"primary":"danger"},{default:n(()=>[c(se(o.status==="0"?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),a(y,{label:"操作"},{default:n(({row:o})=>[a(v,{type:"primary",text:"",onClick:be=>z(o)},{default:n(()=>[c("编辑")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ae,l(N)]]),R(a(Z,{total:l(V),page:l(f).pageNum,"onUpdate:page":t[3]||(t[3]=o=>l(f).pageNum=o),limit:l(f).pageSize,"onUpdate:limit":t[4]||(t[4]=o=>l(f).pageSize=o),onPagination:b},null,8,["total","page","limit"]),[[de,l(V)>0]]),a(te,{title:l(_)==="add"?"新增模板":"编辑模板",modelValue:l(g),"onUpdate:modelValue":t[9]||(t[9]=o=>ie(g)?g.value=o:null),width:"650","close-on-click-modal":!1,onClose:q},{footer:n(()=>[a(v,{onClick:K},{default:n(()=>[c("取 消")]),_:1}),a(v,{type:"primary",onClick:t[8]||(t[8]=o=>W(l(P)))},{default:n(()=>[c("确 定")]),_:1})]),default:n(()=>[a(x,{model:l(s),ref_key:"dialogFormRef",ref:P,rules:l(L),"label-width":"100px"},{default:n(()=>[a(i,{label:"模板名称",prop:"templateName"},{default:n(()=>[a(d,{modelValue:l(s).templateName,"onUpdate:modelValue":t[5]||(t[5]=o=>l(s).templateName=o),placeholder:"请输入模板名称",clearable:""},null,8,["modelValue"])]),_:1}),a(i,{label:"标准照片",prop:"standardPhotoList"},{default:n(()=>[a(ge,{ref_key:"photoTableRef",ref:p,modelValue:l(s).standardPhotoList,"onUpdate:modelValue":t[6]||(t[6]=o=>l(s).standardPhotoList=o),"photo-options":l(F),onValidate:$},null,8,["modelValue","photo-options"])]),_:1}),a(i,{label:"状态"},{default:n(()=>[a(ee,{modelValue:l(s).status,"onUpdate:modelValue":t[7]||(t[7]=o=>l(s).status=o),"active-value":"0","inactive-value":"1"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}}});export{Pe as default};
