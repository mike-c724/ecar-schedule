import{F as z}from"./index-DkNaNI8o.js";import{P as _,_ as G,A as $,r as m,g as c,R as H,o as M,c as J,e as b,f as l,w as o,h as s,x as K,S as Q,l as W,i as X,z as Y,D as Z,am as h,t as ee}from"./index-CBERRbij.js";function te(n=6){return _({url:`/market/common/random-code/${n}`,method:"get"})}function oe(n){return _({url:"/market/write-off-code/add",method:"post",data:n})}function ae(n){return _({url:"/market/write-off-code/list",method:"get",params:n})}function le(n){return _({url:"/market/write-off-code/edit",method:"put",data:n})}const ne={class:"app-container"},re={class:"top-operations"},se={class:"dialog-footer"},ie={class:"dialog-footer"},de=Y({name:"VerificationCodeManagement"}),ce=Object.assign(de,{setup(n){const{proxy:v}=ee(),O=[{type:"index",label:"序号",width:"60"},{prop:"code",label:"核销码",width:"180"},{prop:"phone",label:"发放手机号"},{prop:"createTime",label:"创建时间",width:"180"},{prop:"status",label:"状态",slot:"status"}],R=[{label:"修改",action:"edit"}],u=$({visible:!1}),f=$({visible:!1}),p=m({phone:""}),i=m({writeOffCodeId:"",code:"",phone:"",status:0}),L={phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号码",trigger:"blur"}]},I={phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号码",trigger:"blur"}]},r=m(null),g=m(null),y=m(null),P=e=>({0:"未使用",1:"已使用"})[e]||"未知状态",T=e=>({0:"warning",1:"success"})[e]||"info",D=()=>{u.visible=!0,p.value={phone:""}},w=async e=>{f.visible=!0,await Z();try{i.value={writeOffCodeId:e.writeOffCodeId,phone:e.phone}}catch(t){console.error("获取核销码数据失败:",t),h.error("获取核销码数据失败")}},B=({action:e,row:t})=>{e==="edit"&&w(t)},S=({page:e,limit:t})=>{console.log("分页变化:",e,t)},U=async()=>{if(!g.value){console.error("表单引用不存在");return}g.value.validate(async e=>{if(e){v.$modal.loading("正在新增核销码···");try{await E(),h.success("新增核销码成功"),u.visible=!1,r.value&&typeof r.value.getList=="function"&&r.value.getList()}catch(t){console.error("新增核销码失败:",t)}finally{v.$modal.closeLoading()}}})},A=async()=>{if(!y.value){console.error("表单引用不存在");return}y.value.validate(async e=>{if(e){v.$modal.loading("正在修改核销码···");try{await N(),h.success("修改核销码成功"),f.visible=!1,r.value&&typeof r.value.getList=="function"&&r.value.getList()}catch(t){console.error("修改核销码状态失败:",t)}finally{v.$modal.closeLoading()}}})},C=async()=>{try{return(await te()).data}catch(e){return console.error("生成核销码失败:",e),""}},E=async()=>{try{const e={phone:p.value.phone,code:await C()};await oe(e)}catch(e){throw console.error("新增核销码失败:",e),e}},N=async()=>{try{const e={writeOffCodeId:i.value.writeOffCodeId,phone:i.value.phone,code:await C()};await le(e)}catch(e){throw console.error("编辑核销码失败:",e),e}};return(e,t)=>{const d=c("el-button"),q=c("el-tag"),V=c("el-input"),k=c("el-form-item"),x=c("el-form"),F=c("el-dialog"),j=H("hasPermi");return M(),J("div",ne,[b("div",re,[l(d,{type:"primary",icon:"Plus",onClick:D},{default:o(()=>[s("新增核销码")]),_:1})]),l(z,{ref_key:"formTableRef",ref:r,"form-config":[],"table-columns":O,operations:R,api:X(ae),"init-api":!0,"show-pagination":!0,"show-add":!1,onOperation:B,onPagination:S},{"table-status":o(({row:a})=>[l(q,{type:T(a.status)},{default:o(()=>[s(K(P(a.status)),1)]),_:2},1032,["type"])]),"table-operations":o(({row:a})=>[Q((M(),W(d,{type:a.status==1?"info":"primary",text:"",icon:"Edit",disabled:a.status==1,onClick:ue=>w(a)},{default:o(()=>[s("修改")]),_:2},1032,["type","disabled","onClick"])),[[j,["miniProgram:verificationCode:edit"]]])]),_:1},8,["api"]),l(F,{title:"新增核销码",modelValue:u.visible,"onUpdate:modelValue":t[2]||(t[2]=a=>u.visible=a),width:"500px","append-to-body":""},{footer:o(()=>[b("div",se,[l(d,{type:"primary",onClick:U},{default:o(()=>[s("确 定")]),_:1}),l(d,{onClick:t[1]||(t[1]=a=>u.visible=!1)},{default:o(()=>[s("取 消")]),_:1})])]),default:o(()=>[l(x,{ref_key:"addFormRef",ref:g,model:p.value,rules:L,"label-width":"100px"},{default:o(()=>[l(k,{label:"发放手机号",prop:"phone"},{default:o(()=>[l(V,{modelValue:p.value.phone,"onUpdate:modelValue":t[0]||(t[0]=a=>p.value.phone=a),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(F,{title:"修改核销码状态",modelValue:f.visible,"onUpdate:modelValue":t[5]||(t[5]=a=>f.visible=a),width:"500px","append-to-body":""},{footer:o(()=>[b("div",ie,[l(d,{type:"primary",onClick:A},{default:o(()=>[s("确 定")]),_:1}),l(d,{onClick:t[4]||(t[4]=a=>f.visible=!1)},{default:o(()=>[s("取 消")]),_:1})])]),default:o(()=>[l(x,{ref_key:"modifyFormRef",ref:y,model:i.value,rules:I,"label-width":"100px"},{default:o(()=>[l(k,{label:"发放手机号",prop:"phone"},{default:o(()=>[l(V,{modelValue:i.value.phone,"onUpdate:modelValue":t[3]||(t[3]=a=>i.value.phone=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),me=G(ce,[["__scopeId","data-v-79840d97"]]);export{me as default};
