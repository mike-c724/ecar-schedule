import{r as k,v as V,g as h,o as n,l as f,w as u,c as A,F as z,C as O,ab as v,a2 as M,k as G,m as S,f as j,z as H,R as J,S as Y,ai as q,h as D,x as E,T as W,_ as Q,e as X,aj as L,ak as I}from"./index-CBERRbij.js";const Z=H({name:"FormModule"}),ee=Object.assign(Z,{props:{formItems:{type:Array,required:!0,default:()=>[]},inline:{type:Boolean,default:!0},labelWidth:{type:String,default:"80px"},rules:{type:Object,default:()=>({})},defaultParams:{type:Object,default:()=>({})}},emits:["keyupEnter"],setup(o,{expose:R,emit:T}){const m=o,a=k({}),g=k(null),_=T;m.formItems.forEach(c=>{a.value[c.prop]=null,Object.assign(a.value,m.defaultParams)});const C=()=>new Promise((c,$)=>{g.value.validate(P=>{P?c(a.value):$(new Error("表单验证失败"))})}),d=()=>{_("keyupEnter",a.value)};return R({formData:a,validateForm:C,resetForm:()=>{var c;(c=g.value)==null||c.resetFields()},setFormData:c=>{Object.assign(a.value,c)},form:V(()=>g.value)}),(c,$)=>{const P=h("el-input"),r=h("el-option"),y=h("el-select"),w=h("el-date-picker"),N=h("el-form-item"),B=h("el-form");return n(),f(B,{class:"search-form",ref_key:"formRef",ref:g,model:a.value,inline:o.inline,"label-width":o.labelWidth,rules:o.rules},{default:u(()=>[(n(!0),A(z,null,O(o.formItems,(t,F)=>(n(),A(z,{key:F},[t.isCreate?S("",!0):(n(),f(N,{key:0,label:t.label,prop:t.prop,"label-width":t.labelWidth||""},{default:u(()=>[v(c.$slots,t.prop,{item:t},()=>[t.type==="input"?(n(),f(P,{key:0,modelValue:a.value[t.prop],"onUpdate:modelValue":p=>a.value[t.prop]=p,placeholder:t.placeholder,style:M({width:t.width||"240px"}),onKeyup:G(d,["enter"]),clearable:t.clearable||!0},null,8,["modelValue","onUpdate:modelValue","placeholder","style","clearable"])):S("",!0),t.type==="select"?(n(),f(y,{key:1,modelValue:a.value[t.prop],"onUpdate:modelValue":p=>a.value[t.prop]=p,placeholder:t.placeholder,style:M({width:t.width||"240px"}),clearable:t.clearable||!0},{default:u(()=>[(n(!0),A(z,null,O(t.options,p=>(n(),f(r,{key:p.value,label:p.label,value:p.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","style","clearable"])):S("",!0),t.type==="date"?(n(),f(w,{key:2,modelValue:a.value[t.prop],"onUpdate:modelValue":p=>a.value[t.prop]=p,placeholder:t.placeholder,style:M({width:t.width||"240px"}),type:t.dateType||"date","value-format":t.format||"YYYY-MM-DD",clearable:t.clearable||!0},null,8,["modelValue","onUpdate:modelValue","placeholder","style","type","value-format","clearable"])):S("",!0),t.type==="daterange"?(n(),f(w,{key:3,modelValue:a.value[t.prop],"onUpdate:modelValue":p=>a.value[t.prop]=p,placeholder:t.placeholder,style:M({width:t.width||"240px"}),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":t.format||"YYYY-MM-DD",clearable:t.clearable||!0},null,8,["modelValue","onUpdate:modelValue","placeholder","style","value-format","clearable"])):S("",!0)])]),_:2},1032,["label","prop","label-width"]))],64))),128)),j(N,null,{default:u(()=>[v(c.$slots,"operations",{row:a.value,elRefs:g.value})]),_:3})]),_:3},8,["model","inline","label-width","rules"])}}}),te={class:"table-container"},ae={__name:"index",props:{data:{type:Array,required:!0,default:()=>[]},columns:{type:Array,required:!0,default:()=>[]},operations:{type:Array,default:()=>[]},loading:Boolean,showPagination:{type:Boolean,default:!0},total:{type:Number,default:0},showSelection:{type:Boolean,default:!1},pageSize:{type:Number,default:10},pageNum:{type:Number,default:1},rowKey:{type:String,default:""}},emits:["operation","pagination","selection","selection-change","selection-all","update:pageNum","update:pageSize"],setup(o,{expose:R,emit:T}){const m=o,a=T,g=k(null),_=V({get:()=>m.pageNum,set:r=>a("update:pageNum",r)}),C=V({get:()=>m.pageSize,set:r=>a("update:pageSize",r)}),d=V(()=>m.columns.filter(r=>!r.isCreate)),x=(r,y)=>{a("operation",{action:r,row:y})},U=({page:r,limit:y})=>{a("pagination",{page:r,limit:y})},c=(r,y)=>{a("selection",{action:r,row:y})},$=r=>{a("selection-change",r)},P=r=>{a("selection-all",r)};return R({table:V(()=>g.value)}),(r,y)=>{const w=h("el-table-column"),N=h("dict-tag"),B=h("el-button"),t=h("el-table"),F=h("pagination"),p=J("loading");return n(),A("div",te,[Y((n(),f(t,{class:"table",ref_key:"tableRef",ref:g,style:{width:"100%"},data:o.data,"row-key":o.rowKey,onSelectionChange:$,onSelectAll:P,onSelect:c},{default:u(()=>[(n(!0),A(z,null,O(d.value,(e,l)=>(n(),A(z,{key:l},[["selection","index","expand"].includes(e.type)?(n(),f(w,{key:0,type:e.type,width:e.width||"50",align:e.align||"center",label:e.label,"show-overflow-tooltip":e.showOverflowTooltip||!0,sortable:e.sortable||!1,fixed:e.fixed||!1,formatter:e.formatter||null,selectable:e.selectableFn,"reserve-selection":e.reserveSelection||!1},null,8,["type","width","align","label","show-overflow-tooltip","sortable","fixed","formatter","selectable","reserve-selection"])):e.type==="dict"?(n(),f(w,{key:1,prop:e.prop,label:e.label,align:e.align||"center",width:e.width||"auto","show-overflow-tooltip":e.showOverflowTooltip||!0,sortable:e.sortable||!1,fixed:e.fixed||!1,formatter:e.formatter||null,selectable:e.selectableFn},{default:u(s=>[j(N,{options:e.options,value:s.row[e.prop]},null,8,["options","value"])]),_:2},1032,["prop","label","align","width","show-overflow-tooltip","sortable","fixed","formatter","selectable"])):(n(),f(w,{key:2,prop:e.prop,label:e.label,align:e.align||"center",width:e.width||"auto","show-overflow-tooltip":e.showOverflowTooltip||!0,sortable:e.sortable||!1,fixed:e.fixed||!1,formatter:e.formatter||null,selectable:e.selectableFn},q({_:2},[e.slot?{name:"default",fn:u(s=>[v(r.$slots,e.slot,{row:s.row,index:s.$index})]),key:"0"}:e.formatter?{name:"default",fn:u(s=>[D(E(e.formatter(s.row[e.prop],s.row)),1)]),key:"1"}:{name:"default",fn:u(s=>[D(E(s.row[e.prop]),1)]),key:"2"}]),1032,["prop","label","align","width","show-overflow-tooltip","sortable","fixed","formatter","selectable"]))],64))),128)),o.operations.length>0?(n(),f(w,{key:0,label:"操作",align:"center","min-width":"100"},{default:u(e=>[v(r.$slots,"operations",{row:e.row},()=>[(n(!0),A(z,null,O(o.operations,(l,s)=>Y((n(),f(B,{key:s,type:l.type||"primary",text:"",icon:l.icon||null,onClick:i=>x(l.action,e.row)},{default:u(()=>[D(E(l.formatter?l.formatter(e.row):l.label),1)]),_:2},1032,["type","icon","onClick"])),[[W,!l.show||l.show(e.row)]])),128))])]),_:3})):S("",!0)]),_:3},8,["data","row-key"])),[[p,o.loading]]),o.showPagination?Y((n(),f(F,{key:0,total:o.total,page:_.value,"onUpdate:page":y[0]||(y[0]=e=>_.value=e),limit:C.value,"onUpdate:limit":y[1]||(y[1]=e=>C.value=e),onPagination:U},null,8,["total","page","limit"])),[[W,o.total>0]]):S("",!0)])}}},le={class:"form-table-container"},oe={class:"custom-top-operations"},ne={__name:"index",props:{formConfig:{type:Array,default:()=>[]},tableColumns:{type:Array,required:!0,default:()=>[]},api:{type:Function,default:()=>{}},initApi:{type:Boolean,default:!0},operations:{type:Array,default:()=>[]},showAdd:{type:Boolean,default:!0},showPagination:{type:Boolean,default:!0},defaultParams:{type:Object,default:()=>({})},otherParams:{type:Object,default:()=>({})},daterangeMapList:{type:Array,default:()=>[]},rowKey:{type:String,default:""}},emits:["search","reset","add","operation","pagination","selection-change","selection-all","selection"],setup(o,{expose:R,emit:T}){const m=o,a=T,g=k(!1),_=k(0),C=k([]),d=k({pageNum:1,pageSize:10}),x=V(()=>typeof m.api=="function"&&m.api.toString()!=="() => {}"),U=e=>{var l;d.value.pageNum=1,d.value.pageSize=10,Object.assign(d.value,e),((l=m.daterangeMapList)==null?void 0:l.length)>0&&m.daterangeMapList.forEach(({prop:s,startTime:i,endTime:b})=>{const K=c(d.value[s],i,b);Object.assign(d.value,K)}),x.value&&t(),a("search",d.value)},c=(e,l="startTime",s="endTime")=>{Array.isArray(e)||(e=[]);const[i="",b=""]=e;return{[l]:i||"",[s]:b||""}},$=e=>{d.value={pageNum:1,pageSize:10},e.resetFields(),x.value&&t(),a("reset")},P=()=>{a("add")},r=({action:e,row:l})=>{a("operation",{action:e,row:l})},y=({page:e,limit:l})=>{x.value&&t(),a("pagination",{page:e,limit:l})},w=e=>{a("selection-change",e)},N=e=>{a("selection-all",e)},B=({action:e,row:l})=>{a("selection",{action:e,row:l})},t=async()=>{if(x.value){g.value=!0;try{const e={...m.otherParams,...d.value},{code:l,rows:s,total:i,...b}=await m.api({...e});l===200?(C.value=s,_.value=i):console.error("API响应错误码:",l||"未知错误",b)}catch(e){console.error("获取数据失败:",e)}finally{g.value=!1}}},F=k(null),p=k(null);return R({setTableData:e=>C.value=e,setTotal:e=>_.value=e,setLoading:e=>g.value=e,getList:t,refs:V(()=>({...F.value,...p.value}))}),x.value&&m.initApi&&t(),(e,l)=>{const s=h("el-button");return n(),A("div",le,[X("div",oe,[v(e.$slots,"top-operations",{},void 0,!0)]),o.formConfig.length>0?(n(),f(ee,{key:0,ref_key:"formRef",ref:F,"form-items":o.formConfig,"default-params":o.defaultParams,onKeyupEnter:U},q({operations:u(({row:i,elRefs:b})=>[v(e.$slots,"form-operations-prefix",{},void 0,!0),j(s,{type:"primary",icon:"Search",onClick:K=>U(i)},{default:u(()=>[D("查询")]),_:2},1032,["onClick"]),j(s,{icon:"Refresh",onClick:K=>$(b)},{default:u(()=>[D("重置")]),_:2},1032,["onClick"]),o.showAdd?(n(),f(s,{key:0,type:"primary",icon:"Plus",onClick:P},{default:u(()=>[D("新增")]),_:1})):S("",!0),v(e.$slots,"form-operations-suffix",{},void 0,!0)]),_:2},[O(o.formConfig,i=>({name:i.prop,fn:u(b=>[v(e.$slots,`form-${i.prop}`,L(I(b)),void 0,!0)])}))]),1032,["form-items","default-params"])):S("",!0),j(ae,{ref_key:"tableRef",ref:p,data:C.value,columns:o.tableColumns,operations:o.operations,loading:g.value,"show-pagination":o.showPagination,total:_.value,"row-key":o.rowKey,"page-size":d.value.pageSize,"onUpdate:pageSize":l[0]||(l[0]=i=>d.value.pageSize=i),"page-num":d.value.pageNum,"onUpdate:pageNum":l[1]||(l[1]=i=>d.value.pageNum=i),onOperation:r,onPagination:y,onSelectionChange:w,onSelectionAll:N,onSelection:B},q({operations:u(i=>[v(e.$slots,"table-operations",L(I(i)),void 0,!0)]),_:2},[O(o.tableColumns,i=>({name:i.slot,fn:u(b=>[v(e.$slots,`table-${i.slot}`,L(I(b)),void 0,!0)])}))]),1032,["data","columns","operations","loading","show-pagination","total","row-key","page-size","page-num"])])}}},se=Q(ne,[["__scopeId","data-v-7d6d3ea3"]]);export{se as F};
