import{b7 as uo,b8 as po,_ as ho,a as vo,u as fo,r as C,b as mo,g as h,o as d,c as u,f as a,w as n,e as i,h as S,m as D,F as I,C as _,l as V,n as k,i as O,x as go,aE as Io,ag as _o,t as Po,b4 as bo,p as Lo,q as Uo}from"./index-Bz8aCySx.js";import yo from"./uploadVehicleDamageZip-DNOzsa65.js";import{i as Co,L as Vo}from"./useOrderInfo-oTm2EOs0.js";const ko=async()=>{const m=await uo(Co.value);return Vo.value=m.data,m.data},wo=async m=>{try{const{code:y}=await po(m);return y===200}catch{}return!1},Do=m=>(Lo("data-v-c296f243"),m=m(),Uo(),m),$o={class:"vehicle-damage-info-template"},So={class:"header"},xo={class:"upload_btn_group"},Oo={class:"damage_assessment"},Mo={class:"cardBox"},Ao=Do(()=>i("div",{class:"card-header"},"车辆图片",-1)),Bo={class:"content"},To={class:"standardPhotoItem"},Eo={class:"option-content"},Ko=["onClick"],No={key:0,class:"tag-container"},zo={class:"standardPhotoItem"},Fo={class:"option-content"},Ro=["onClick"],jo={key:0,class:"tag-container"},qo={class:"standardPhotoItem"},Zo={class:"option-content"},Go=["onClick"],Ho={key:0,class:"tag-container"},Jo={key:0,class:"item-damage-parts"},Qo={class:"card-header"},Wo={class:"inputBox"},Xo={class:"operate_box"},Yo={class:"content-damage"},oe={class:"option-content"},ee=["onClick"],te={key:0,class:"tag-container"},le={class:"tag-label"},ae={class:"parts-list"},se={style:{"text-align":"right","margin-top":"32px"}},ne={__name:"vehicleDamageInfoTemplate",setup(m){const{proxy:y}=Po(),{damage_advice:Z,damage_position:G}=y.useDict("damage_advice","damage_position"),H=vo(),J=fo(),l=C({frontPhoto:{photoId:"",photoUrl:""},backPhoto:{photoId:"",photoUrl:""},platePhoto:{photoId:"",photoUrl:""},orderId:"",partsInfoList:[],othersDescription:"",unselectedPhotoList:[]}),$=C({}),M=C(!1),A=C([]),B=C(0),T=C(!1),F=C([]),Q={label:"name",value:"id",children:"children",checkStrictly:!1};function w(t){!t||!t.photoId||l.value.unselectedPhotoList.some(o=>o.photoId===t.photoId)||l.value.unselectedPhotoList.unshift(t)}const W=async()=>{try{const t=await bo();F.value=t.data||[]}catch(t){console.error("Failed to fetch damage tree list:",t)}},X=t=>{t.forEach(o=>{w({photoId:o.orderPhotoId,photoUrl:o.photoOriginal})})},Y=()=>{["frontPhoto","backPhoto","platePhoto"].forEach(t=>{const{photoId:o,photoUrl:s}=l.value[t]||{};o&&w({photoId:o,photoUrl:s})}),l.value.partsInfoList.forEach(t=>{(t.partsPhotoIdList||[]).forEach((o,s)=>{let p="";if(t.photoList&&Array.isArray(t.photoList)){const c=t.photoList.find(v=>v.photoId===o);c&&(p=c.photoUrl)}w({photoId:o,photoUrl:p})})})},P=({currentKey:t="",currentIdx:o=-1,currentIds:s=[]})=>{const p=[l.value.frontPhoto.photoId,l.value.backPhoto.photoId,l.value.platePhoto.photoId].filter(Boolean),c=l.value.partsInfoList.flatMap((f,b)=>o!==-1&&b===o?[]:f.partsPhotoIdList||[]).filter(Boolean),v=Array.isArray(s)?s:s?[s]:[];return l.value.unselectedPhotoList.filter(f=>!p.includes(f.photoId)&&!c.includes(f.photoId)||v.includes(f.photoId))},oo=(t,o)=>{const s=(o||[]).map(p=>l.value.unselectedPhotoList.find(c=>c.photoId===p)).filter(Boolean);t.photoList=s},E=(t,o)=>{t&&($.value[o]={photoId:l.value[o].photoId,photoUrl:l.value[o].photoUrl},l.value[o].photoId&&w({photoId:l.value[o].photoId,photoUrl:l.value[o].photoUrl}))},K=t=>{var p,c;let o=(p=$.value[t])==null?void 0:p.photoId,s=(c=$.value[t])==null?void 0:c.photoUrl;o||(o=l.value[t].photoId,s=l.value[t].photoUrl),o&&(w({photoId:o,photoUrl:s}),l.value[t].photoId="",l.value[t].photoUrl="",$.value[t]={photoId:"",photoUrl:""})},eo=(t,o)=>{t.photoList=t.photoList.filter(s=>s.photoId!==o.photoId),t.partsPhotoIdList=t.partsPhotoIdList.filter(s=>s!==o.photoId),w({photoId:o.photoId,photoUrl:o.photoUrl})},N=t=>{const o=l.value.unselectedPhotoList.find(s=>s.photoId===l.value[t].photoId);l.value[t].photoUrl=o?o.photoUrl:""};function x(t,o){A.value=(o||[]).map(s=>s.photoUrl),B.value=(o||[]).findIndex(s=>s.photoId===t.photoId),M.value=!0}function to(){M.value=!1,A.value=[],B.value=0}const R=()=>{l.value.partsInfoList.push({partsName:"",damageSuggestion:"",photoList:[],partsPhotoIdList:[],lossInfoList:[{damageId:[],damagePart:""}]})},lo=t=>{l.value.partsInfoList.splice(t,1)},ao=t=>{l.value.partsInfoList[t].lossInfoList.push({damageId:"",damagePart:""})},so=(t,o)=>{const s=l.value.partsInfoList[t].lossInfoList;s.length>1&&s.splice(o,1)},j=async()=>{y.$modal.loading("正在保存...");const t=await wo(l.value);return t&&y.$message.success("保存成功"),y.$modal.closeLoading(),t},no=()=>{j().then(t=>{t&&H.push({path:`/evaluationManagement/conclusion/view/${J.params.id}`})})};return mo(async()=>{await W(),l.value=await ko(),l.value.partsInfoList.length||R(),Y(),["platePhoto"].forEach(t=>{$.value[t]={photoId:l.value[t].photoId,photoUrl:l.value[t].photoUrl}})}),(t,o)=>{const s=h("el-button"),p=h("el-input"),c=h("el-image"),v=h("el-option"),f=h("el-tag"),b=h("el-select"),z=h("el-form-item"),q=h("el-card"),ro=h("el-cascader"),io=h("el-form"),co=h("el-image-viewer");return d(),u("div",$o,[a(io,{model:l.value,"label-width":"auto"},{default:n(()=>[i("div",So,[i("div",xo,[a(s,{icon:"Plus",type:"primary",onClick:o[0]||(o[0]=e=>T.value=!0)},{default:n(()=>[S(" 上传定损图片 ")]),_:1})]),i("div",Oo,[a(p,{modelValue:l.value.othersDescription,"onUpdate:modelValue":o[1]||(o[1]=e=>l.value.othersDescription=e),placeholder:"请输入其它定损零部件说明"},null,8,["modelValue"])])]),i("div",Mo,[a(q,{style:{width:"100%"}},{header:n(()=>[Ao]),default:n(()=>[i("div",Bo,[i("div",To,[a(z,{label:"车辆正前"},{default:n(()=>[a(b,{modelValue:l.value.frontPhoto.photoId,"onUpdate:modelValue":o[2]||(o[2]=e=>l.value.frontPhoto.photoId=e),onClear:o[3]||(o[3]=e=>K("frontPhoto")),placeholder:"请选择车辆正前",style:{width:"100%",height:"134px"},class:"custom-select",onVisibleChange:o[4]||(o[4]=e=>E(e,"frontPhoto")),onChange:o[5]||(o[5]=e=>N("frontPhoto")),clearable:"","popper-class":"custom-select-popper"},{label:n(()=>[l.value.frontPhoto.photoUrl?(d(),u("div",No,[a(f,{class:"custom-tag",size:"large","disable-transitions":!1},{default:n(()=>[a(c,{class:"tag-image",src:l.value.frontPhoto.photoUrl,fit:"contain"},null,8,["src"])]),_:1})])):D("",!0)]),default:n(()=>[(d(!0),u(I,null,_(P({currentKey:"frontPhoto",currentIds:l.value.frontPhoto.photoId}),e=>(d(),V(v,{key:e.photoId,label:e.photoId,value:e.photoId,class:"custom-option"},{default:n(()=>[i("div",Eo,[a(c,{class:"option-image",src:e.photoUrl,fit:"contain"},null,8,["src"]),i("span",{class:"option-label",onClick:k(g=>x(e,P({currentKey:"frontPhoto",currentIds:l.value.frontPhoto.photoId})),["stop"])}," 查看大图 ",8,Ko)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),i("div",zo,[a(z,{label:"车辆正后"},{default:n(()=>[a(b,{modelValue:l.value.backPhoto.photoId,"onUpdate:modelValue":o[6]||(o[6]=e=>l.value.backPhoto.photoId=e),placeholder:"请选择车辆正后",style:{width:"100%"},onClear:o[7]||(o[7]=e=>K("backPhoto")),class:"custom-select",onVisibleChange:o[8]||(o[8]=e=>E(e,"backPhoto")),onChange:o[9]||(o[9]=e=>N("backPhoto")),clearable:"","popper-class":"custom-select-popper"},{label:n(()=>[l.value.backPhoto.photoUrl?(d(),u("div",jo,[a(f,{class:"custom-tag",size:"large","disable-transitions":!1},{default:n(()=>[a(c,{class:"tag-image",src:l.value.backPhoto.photoUrl,fit:"contain"},null,8,["src"])]),_:1})])):D("",!0)]),default:n(()=>[(d(!0),u(I,null,_(P({currentKey:"backPhoto",currentIds:l.value.backPhoto.photoId}),e=>(d(),V(v,{key:e.photoId,label:e.photoId,value:e.photoId,class:"custom-option"},{default:n(()=>[i("div",Fo,[a(c,{class:"option-image",src:e.photoUrl,fit:"contain"},null,8,["src"]),i("span",{class:"option-label",onClick:k(g=>x(e,P({currentKey:"backPhoto",currentIds:l.value.backPhoto.photoId})),["stop"])}," 查看大图 ",8,Ro)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),i("div",qo,[a(z,{label:"车辆铭牌"},{default:n(()=>[a(b,{modelValue:l.value.platePhoto.photoId,"onUpdate:modelValue":o[10]||(o[10]=e=>l.value.platePhoto.photoId=e),placeholder:"请选择车辆铭牌",style:{width:"100%"},class:"custom-select",onVisibleChange:o[11]||(o[11]=e=>E(e,"platePhoto")),onClear:o[12]||(o[12]=e=>K("platePhoto")),onChange:o[13]||(o[13]=e=>N("platePhoto")),clearable:"","popper-class":"custom-select-popper"},{label:n(()=>[l.value.platePhoto.photoUrl?(d(),u("div",Ho,[a(f,{class:"custom-tag",size:"large","disable-transitions":!1},{default:n(()=>[a(c,{class:"tag-image",src:l.value.platePhoto.photoUrl,fit:"contain"},null,8,["src"])]),_:1})])):D("",!0)]),default:n(()=>[(d(!0),u(I,null,_(P({currentKey:"platePhoto",currentIds:l.value.platePhoto.photoId}),e=>(d(),V(v,{key:e.photoId,label:e.photoId,value:e.photoId,class:"custom-option"},{default:n(()=>[i("div",Zo,[a(c,{class:"option-image",src:e.photoUrl,fit:"contain"},null,8,["src"]),i("span",{class:"option-label",onClick:k(g=>x(e,P({currentKey:"platePhoto",currentIds:l.value.platePhoto.photoId})),["stop"])}," 查看大图 ",8,Go)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})])])]),_:1}),a(s,{icon:"Plus",type:"primary",onClick:R},{default:n(()=>[S("添加损伤")]),_:1}),l.value.partsInfoList.length?(d(),u("div",Jo,[(d(!0),u(I,null,_(l.value.partsInfoList,(e,g)=>(d(),u("div",{class:"custom-card",key:g},[a(q,{style:{width:"100%"}},{header:n(()=>[i("div",Qo,[i("div",Wo,[a(p,{modelValue:e.partsName,"onUpdate:modelValue":r=>e.partsName=r,style:{width:"240px"},placeholder:"请输入备件名称"},null,8,["modelValue","onUpdate:modelValue"])]),i("div",Xo,[a(b,{modelValue:e.damageSuggestion,"onUpdate:modelValue":r=>e.damageSuggestion=r,style:{width:"240px"},placeholder:"请选择伤损建议"},{default:n(()=>[(d(!0),u(I,null,_(O(Z),r=>(d(),V(v,{key:r.value,label:r.label,value:r.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]),a(s,{icon:"Delete",type:"danger",onClick:r=>lo(g)},{default:n(()=>[S(" 移除损伤 ")]),_:2},1032,["onClick"])])])]),default:n(()=>[i("div",Yo,[a(b,{modelValue:e.partsPhotoIdList,"onUpdate:modelValue":r=>e.partsPhotoIdList=r,onChange:r=>oo(e,r),multiple:"",placeholder:"请选择损伤类型图片",style:{width:"100%"},class:"custom-select","popper-class":"custom-select-popper"},{tag:n(()=>[e.photoList&&e.photoList.length?(d(),u("div",te,[(d(!0),u(I,null,_(e.photoList,r=>(d(),V(f,{key:r.photoId,class:"custom-tag",closable:"",size:"large","disable-transitions":!1,onClose:L=>eo(e,r)},{default:n(()=>[a(c,{class:"tag-image",src:r.photoUrl,fit:"contain"},null,8,["src"]),i("span",le,go(r.photoId),1)]),_:2},1032,["onClose"]))),128))])):D("",!0)]),default:n(()=>[(d(!0),u(I,null,_(P({currentIdx:g,currentIds:e.partsPhotoIdList}),r=>(d(),V(v,{key:r.photoId,label:r.photoId,value:r.photoId,class:"custom-option"},{default:n(()=>[i("div",oe,[a(c,{class:"option-image",src:r.photoUrl,fit:"contain"},null,8,["src"]),i("span",{class:"option-label",onClick:k(L=>x(r,P({currentIdx:g,currentIds:e.partsPhotoIdList})),["stop"])}," 查看大图 ",8,ee)])]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),i("div",ae,[(d(!0),u(I,null,_(e.lossInfoList,(r,L)=>(d(),u("div",{class:"row-parts",key:L,style:{display:"flex","align-items":"center",gap:"12px"}},[a(ro,{modelValue:e.lossInfoList[L].damageId,"onUpdate:modelValue":U=>e.lossInfoList[L].damageId=U,options:F.value,props:Q,filterable:"",clearable:"",style:{width:"240px"},placeholder:"请选择备件材质"},null,8,["modelValue","onUpdate:modelValue","options"]),a(b,{modelValue:r.damagePart,"onUpdate:modelValue":U=>r.damagePart=U,placeholder:"请选择伤损部位",style:{width:"240px"}},{default:n(()=>[(d(!0),u(I,null,_(O(G),U=>(d(),V(v,{key:U.value,label:U.label,value:U.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]),a(s,{type:"primary",onClick:U=>L===0?ao(g):so(g,L),icon:L===0?O(Io):O(_o)},null,8,["onClick","icon"])]))),128))])])]),_:2},1024)]))),128))])):D("",!0)])]),_:1},8,["model"]),M.value?(d(),u("div",{key:0,class:"image-viewer-mask",onMousedown:o[14]||(o[14]=k(()=>{},["stop"])),onMouseup:o[15]||(o[15]=k(()=>{},["stop"])),onClick:o[16]||(o[16]=k(()=>{},["stop"]))},[a(co,{"url-list":A.value,"initial-index":B.value,onClose:to},null,8,["url-list","initial-index"])],32)):D("",!0),a(yo,{visibleDamageAssessment:T.value,"onUpdate:visibleDamageAssessment":o[17]||(o[17]=e=>T.value=e),onSuccess:X},null,8,["visibleDamageAssessment"]),i("div",se,[a(s,{type:"primary",onClick:no},{default:n(()=>[S("查看结论")]),_:1}),a(s,{type:"primary",onClick:j},{default:n(()=>[S("保存")]),_:1})])])}}},re=ho(ne,[["__scopeId","data-v-c296f243"]]),ue=Object.freeze(Object.defineProperty({__proto__:null,default:re},Symbol.toStringTag,{value:"Module"}));export{ue as a,wo as s,re as v};
