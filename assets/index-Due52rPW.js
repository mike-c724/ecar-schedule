import{_ as Re,a as De,r as f,A as Te,v as Ie,u as Le,J as Oe,K as $e,b as xe,g as k,o as r,c as T,e as h,i as o,l as c,m as y,f as s,w as a,F as O,C as $,h as I,B as ae,z as Be,t as Ue,an as Ee,ao as We,Q as Ke,a9 as je,ap as Ae,aq as Ge,p as Me,q as Ne}from"./index-Bz8aCySx.js";import R from"./PartResult-DSAZSRCC.js";import Pe from"./BottomResult-BQwGMl1Z.js";import{$ as G}from"./index-CXdL54YQ.js";import"./jsencrypt.min-C2S-MpmI.js";import ze from"./orderInfoDialog-CHjeVXK7.js";import{O as oe,B as Fe}from"./BatteryReport-DDjkUacU.js";import He from"./DiagnosticReport-XkE1AJhT.js";import"./PointPic-DHP27_w8.js";import"./PointBottom-CAarwuvc.js";const E=W=>(Me("data-v-4a5de97a"),W=W(),Ne(),W),qe={class:"app-container detection"},Je=E(()=>h("div",{class:"card-header"},[h("span",null,"事故判定")],-1)),Qe={class:"card-header"},Xe=E(()=>h("span",null,"全车评测结论",-1)),Ye=E(()=>h("div",{class:"card-header"},[h("span",null,"整车评级")],-1)),Ze={class:"card-header"},et=E(()=>h("span",null,"动力电池评测结论",-1)),tt=E(()=>h("div",{class:"card-header"},[h("span",null,"底盘健康度等级评级")],-1)),at={class:"card-header"},ot=E(()=>h("span",null,"风险等级",-1)),lt={class:"obd-content"},st=Be({name:"Detection"}),nt=Object.assign(st,{setup(W){const M=De(),{proxy:u}=Ue(),{accident_level:le}=u.useDict("accident_level"),H=f(""),N=Te({orderInfoDialogVisible:!1,orderInfoDetail:{}}),i=f({accidentType:[],orderScore:"",wholeConclusion:"",batteryScore:"",batteryConclusion:"",riskLevelList:[],riskScore:"",riskScoreDesc:"",isItRepaired:""}),P=f({showAccidentType:!1,showChassisDetectionConclusion:!1,showChassisHealthGrade:!1,showRiskGrade:!1,showVehicleRatingConclusion:!1,showWholeConclusion:!1}),q=f([]),J=f([]),z=f([]),K=f([]),se=f([{label:"需进场检修",value:0},{label:"继续行驶",value:1}]),Q=Ie(()=>i.value.riskLevelList.flatMap(e=>e.selectedRiskType)),D=e=>!!P.value[e],ne=e=>Q.value.length?Q.value.includes(e.conclusionScoreKey):!1,re=e=>{if(e){const t=z.value.find(p=>p.conclusionScoreKey===e);i.value.riskScoreDesc=t?t.conclusionScoreValue:""}else i.value.riskScoreDesc=""},ie=(e,t)=>{const p=i.value.riskLevelList[t],d=K.value.find(n=>n.conclusionScoreKey===e);if(p.selectedRiskTypeDesc=(d==null?void 0:d.conclusionScoreValue)||"",!p.riskTypeConclusion.trim()){p.riskTypeConclusion=(d==null?void 0:d.remark)||"";return}K.value.some(n=>n.remark===p.riskTypeConclusion)&&(p.riskTypeConclusion=(d==null?void 0:d.remark)||"")},ce=()=>{const e={customizeId:new Date().getTime(),selectedRiskType:"",selectedRiskTypeDesc:"",riskTypeConclusion:""};i.value.riskLevelList.push(e)},ue=e=>{i.value.riskLevelList.length>1?i.value.riskLevelList.splice(e,1):u.$modal.msgWarning("至少保留一个风险类型")},de=()=>{M.push({path:`/evaluationManagement/toBeEvaluated/${Z.params.id}`})},X=()=>{M.push({path:"/evaluationManagement/orderGrabbinghall"})},Y=()=>{G.getAllOrderInfo(_.value).then(({data:e})=>{H.value=e.orderType||"";const{orderConclusion:t}=e||{},{accidentType:p,orderScore:d,wholeConclusion:v,batteryScore:n,batteryConclusion:m,riskLevelList:L,riskScore:x,isItRepaired:C,riskScoreDesc:B}=t||{},S={accidentType:p||[],orderScore:d||"",wholeConclusion:v||"",batteryScore:n||"",batteryConclusion:m||"",riskLevelList:L||[],riskScore:x||"",isItRepaired:C||"",riskScoreDesc:B||""};if(S.riskLevelList.length===0){const U={customizeId:new Date().getTime(),selectedRiskType:"",selectedRiskTypeDesc:"",riskTypeConclusion:""};S.riskLevelList.push(U)}else S.riskLevelList.forEach(U=>{U.customizeId||(U.customizeId=new Date().getTime()+Math.random())});Object.assign(i.value,S)})},Z=Le(),_=f("");_.value=Z.params.id,Oe("orderId",_.value);const pe=()=>{Y(),he()},V=f(!1),ee=()=>new Promise((e,t)=>{const p=[],d={accidentType:{label:"事故类型",keys:"showAccidentType"},orderScore:{label:"整车评级",keys:"showVehicleRatingConclusion"},wholeConclusion:{label:"整车结论",keys:"showWholeConclusion"},batteryScore:{label:"电池评分",keys:"showChassisHealthGrade"},batteryConclusion:{label:"电池结论",keys:"showChassisDetectionConclusion"},riskScore:{label:"风险度评分",keys:"showRiskGrade"}};if(Object.keys(d).forEach(n=>{D(d[n].keys)&&!i.value[n]&&p.push(`${d[n].label}`)}),D("showRiskGrade")&&(i.value.riskLevelList.every(m=>{var C;const L=!!m.selectedRiskType,x=!!((C=m.riskTypeConclusion)!=null&&C.trim());return L===x})||p.push("风险等级列表中每行的风险类型和结论必须同时填写或同时为空")),p.length>0){const n=`请完善以下信息: ${p.join("、")}`;u.$modal.msgWarning(n),t(new Error(n));return}V.value=!0;const v=i.value.riskLevelList.filter(n=>{var m;return n.selectedRiskType&&((m=n.riskTypeConclusion)==null?void 0:m.trim())});G.saveConclusion(_.value,{...i.value,riskLevelList:v}).then(n=>{u.$modal.msgSuccess("保存结论成功"),Y(),e(n)}).catch(n=>{t(n)}).finally(()=>{V.value=!1})}),me=()=>{N.orderInfoDialogVisible=!0},ye=()=>{V.value=!0,ee().then(()=>G.orderPass(_.value)).then(()=>{u.$modal.msgSuccess("评测成功"),X()}).catch(e=>{}).finally(()=>{V.value=!1})},g=f({covers_points:!1,interior_points:!1,structure_points:!1,electromechanical_points:!1,hasChassisInspection:!1,hasOrderScoreInspection:!1,hasTripsInspection:!1,new_energy_chassis:!1,static_function_detection:!1,dynamic_function_detection:!1,physical_damage_detection:!1}),he=()=>{G.getRealParts(_.value).then(e=>{const{partParts:t,hasChassisInspection:p,...d}=e.data||{},v=t||[];Object.keys(g.value).forEach(n=>{g.value[n]=v.includes(n)}),g.value.hasChassisInspection=p||!1,Object.keys(P.value).forEach(n=>{P.value[n]=d[n]||!1})})},fe=()=>{Ee().then(e=>{q.value=e.data.filter(t=>t.conclusionType==1),J.value=e.data.filter(t=>t.conclusionType==2),z.value=e.data.filter(t=>t.conclusionType==3),K.value=e.data.filter(t=>t.conclusionType==4)})},_e=()=>{We(_.value).then(e=>{e.data?e.data.status==0?u.$modal.msgWarning("该订单未查询出现记录"):e.data.status==1?window.open(e.data.orderUrl):u.$modal.msgWarning("未查询到出险信息"):u.$modal.msgWarning("未查询到出险信息")})},ge=()=>{Ke(_.value).then(e=>{e.data?e.data.status==2?u.$modal.msgWarning("该订单宁檬查报告查询中，请稍后再试"):e.data.status==1?M.push({path:`/evaluationManagement/conclusion/accidentOccurred/${_.value}`}):u.$modal.msgWarning("未查询到宁檬查报告信息"):u.$modal.msgWarning("该订单未查询出现记录")})},j=f(!1),F=f(new oe),ve=async()=>{u.$modal.loading("正在查询电池报告信息...");try{const e=await je(_.value);e.data?(j.value=!0,Object.keys(F.value).forEach(t=>{e.data[t]=ke(e.data[t])}),F.value=new oe(e.data)):u.$modal.msgWarning("未查询到三电报告信息")}catch{}finally{u.$modal.closeLoading()}},ke=e=>{try{if(typeof e=="string")return JSON.parse(e)}catch{return e}return e},te=f({}),A=f(!1),be=async()=>{u.$modal.loading("正在查询OBD数据...");try{const e=await Ae(_.value);e.data?(A.value=!0,te.value=e.data):u.$modal.msgWarning("未查询到OBD数据")}catch{}finally{u.$modal.closeLoading()}},Ce=()=>{u.$modal.confirm("是否确认将该订单转为定损线下？").then(()=>{V.value=!0,Ge(_.value).then(()=>{u.$modal.msgSuccess("操作成功"),X()}).finally(()=>{V.value=!1})}).catch(()=>{})};return $e(()=>{}),xe(()=>{pe(),fe()}),(e,t)=>{const p=k("el-checkbox"),d=k("el-checkbox-group"),v=k("el-card"),n=k("el-col"),m=k("el-button"),L=k("el-input"),x=k("el-space"),C=k("el-row"),B=k("el-radio"),S=k("el-radio-group"),U=k("el-option"),we=k("el-select"),Ve=k("el-dialog");return r(),T("div",qe,[h("div",{class:"rightFloat"},[h("div",{class:"rightFloat-box"},[h("div",{class:"slider-btnItem",onClick:me},"订单信息")])]),o(g).covers_points?(r(),c(R,{key:0,type:"covers_points"})):y("",!0),o(g).interior_points?(r(),c(R,{key:1,type:"interior_points"})):y("",!0),o(g).electromechanical_points?(r(),c(R,{key:2,type:"electromechanical_points"})):y("",!0),o(g).structure_points?(r(),c(R,{key:3,type:"structure_points"})):y("",!0),o(g).wearing_parts?(r(),c(R,{key:4,type:"wearing_parts"})):y("",!0),o(g).chassis_modules?(r(),c(R,{key:5,type:"chassis_modules"})):y("",!0),o(g).new_energy_chassis?(r(),c(R,{key:6,type:"new_energy_chassis"})):y("",!0),o(g).static_function_detection?(r(),c(R,{key:7,type:"static_function_detection"})):y("",!0),o(g).physical_damage_detection?(r(),c(R,{key:8,type:"physical_damage_detection"})):y("",!0),o(g).hasChassisInspection?(r(),c(Pe,{key:9})):y("",!0),s(C,{style:{"margin-bottom":"20px"},gutter:20},{default:a(()=>[D("showAccidentType")?(r(),c(n,{key:0,span:6},{default:a(()=>[s(v,null,{header:a(()=>[Je]),default:a(()=>[s(d,{modelValue:o(i).accidentType,"onUpdate:modelValue":t[0]||(t[0]=l=>o(i).accidentType=l)},{default:a(()=>[(r(!0),T(O,null,$(o(le),(l,b)=>(r(),c(p,{value:l.value,label:l.label,key:b},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})):y("",!0),D("showWholeConclusion")?(r(),c(n,{key:1,span:18},{default:a(()=>[s(v,null,{header:a(()=>[h("div",Qe,[Xe,s(m,{type:"primary",onClick:_e,class:"report-btn"},{default:a(()=>[I(" 车E估报告 ")]),_:1}),s(m,{type:"primary",onClick:ge,class:"report-btn"},{default:a(()=>[I(" 柠檬查报告 ")]),_:1}),s(m,{type:"primary",onClick:ve,class:"report-btn"},{default:a(()=>[I(" 三电报告 ")]),_:1}),s(m,{type:"primary",onClick:be,class:"report-btn"},{default:a(()=>[I(" OBD数据 ")]),_:1})])]),default:a(()=>[s(x,{direction:"vertical",style:{width:"100%"},fill:!0},{default:a(()=>[s(L,{modelValue:o(i).wholeConclusion,"onUpdate:modelValue":t[1]||(t[1]=l=>o(i).wholeConclusion=l),rows:3,maxlength:"500","show-word-limit":"",type:"textarea",placeholder:"请输入全车评测结论"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})):y("",!0)]),_:1}),s(C,{style:{"margin-bottom":"20px"},gutter:20},{default:a(()=>[D("showVehicleRatingConclusion")?(r(),c(n,{key:0,span:6},{default:a(()=>[s(v,null,{header:a(()=>[Ye]),default:a(()=>[s(S,{modelValue:o(i).orderScore,"onUpdate:modelValue":t[2]||(t[2]=l=>o(i).orderScore=l)},{default:a(()=>[(r(!0),T(O,null,$(o(q),(l,b)=>(r(),c(B,{value:l.conclusionScoreKey,label:l.conclusionScoreKey,key:b},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})):y("",!0),D("showChassisDetectionConclusion")?(r(),c(n,{key:1,span:18},{default:a(()=>[s(v,null,{header:a(()=>[h("div",Ze,[et,s(S,{class:"report-btn",modelValue:o(i).isItRepaired,"onUpdate:modelValue":t[3]||(t[3]=l=>o(i).isItRepaired=l)},{default:a(()=>[(r(!0),T(O,null,$(o(se),(l,b)=>(r(),c(B,{value:l.value,label:l.label,key:b},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])])]),default:a(()=>[s(L,{modelValue:o(i).batteryConclusion,"onUpdate:modelValue":t[4]||(t[4]=l=>o(i).batteryConclusion=l),rows:3,maxlength:"500","show-word-limit":"",type:"textarea",placeholder:"请输入动力电池评测结论"},null,8,["modelValue"])]),_:1})]),_:1})):y("",!0)]),_:1}),s(C,{gutter:20},{default:a(()=>[D("showChassisHealthGrade")?(r(),c(n,{key:0,span:6},{default:a(()=>[s(v,null,{header:a(()=>[tt]),default:a(()=>[s(S,{modelValue:o(i).batteryScore,"onUpdate:modelValue":t[5]||(t[5]=l=>o(i).batteryScore=l)},{default:a(()=>[(r(!0),T(O,null,$(o(J),(l,b)=>(r(),c(B,{value:l.conclusionScoreKey,label:l.conclusionScoreKey,key:b},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})):y("",!0),D("showRiskGrade")?(r(),c(n,{key:1,span:18},{default:a(()=>[s(v,null,{header:a(()=>[h("div",at,[ot,s(S,{class:"report-btn",onChange:re,modelValue:o(i).riskScore,"onUpdate:modelValue":t[6]||(t[6]=l=>o(i).riskScore=l)},{default:a(()=>[(r(!0),T(O,null,$(o(z),(l,b)=>(r(),c(B,{value:l.conclusionScoreKey,label:l.conclusionScoreValue,key:b},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])])]),default:a(()=>[(r(!0),T(O,null,$(o(i).riskLevelList,(l,b)=>(r(),c(C,{gutter:20,key:l.customizeId,class:"health-level-list"},{default:a(()=>[s(n,{span:6},{default:a(()=>[s(we,{modelValue:l.selectedRiskType,"onUpdate:modelValue":w=>l.selectedRiskType=w,onChange:w=>ie(w,b),placeholder:"请选择风险类型"},{default:a(()=>[(r(!0),T(O,null,$(o(K),(w,Se)=>(r(),c(U,{label:w.conclusionScoreValue,value:w.conclusionScoreKey,key:Se,disabled:ne(w)},null,8,["label","value","disabled"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1024),s(n,{span:15},{default:a(()=>[s(L,{modelValue:l.riskTypeConclusion,"onUpdate:modelValue":w=>l.riskTypeConclusion=w,rows:1,maxlength:"100","show-word-limit":"",type:"textarea",placeholder:"请输入风险类型结论"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),s(n,{span:3},{default:a(()=>[s(m,{type:"primary",icon:"plus",circle:"",onClick:ce}),s(m,{type:"danger",icon:"delete",circle:"",onClick:w=>ue(b)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):y("",!0)]),_:1}),s(C,{style:{"padding-bottom":"60px"},gutter:20}),s(C,{gutter:20},{default:a(()=>[s(n,{span:21},{default:a(()=>[s(x,{style:{"justify-content":"center"}},{default:a(()=>[s(m,{onClick:de},{default:a(()=>[I("上一步")]),_:1}),s(m,{loading:o(V),type:"primary",onClick:ee},{default:a(()=>[I("保存结论")]),_:1},8,["loading"]),s(m,{loading:o(V),type:"primary",onClick:ye},{default:a(()=>[I("评测完成")]),_:1},8,["loading"]),["4","6","7"].includes(o(H))?(r(),c(m,{key:0,loading:o(V),type:"danger",onClick:Ce},{default:a(()=>[I(" 转定损线下 ")]),_:1},8,["loading"])):y("",!0)]),_:1})]),_:1})]),_:1}),s(ze,{visible:o(N).orderInfoDialogVisible,"onUpdate:visible":t[7]||(t[7]=l=>o(N).orderInfoDialogVisible=l),orderId:o(_)},null,8,["visible","orderId"]),s(Fe,{visible:o(j),"onUpdate:visible":t[8]||(t[8]=l=>ae(j)?j.value=l:null),batteryReportData:o(F)},null,8,["visible","batteryReportData"]),s(Ve,{modelValue:o(A),"onUpdate:modelValue":t[9]||(t[9]=l=>ae(A)?A.value=l:null),width:"800px",title:"OBD数据"},{default:a(()=>[h("div",lt,[s(He,{diagnosticData:o(te)},null,8,["diagnosticData"])])]),_:1},8,["modelValue"])])}}}),_t=Re(nt,[["__scopeId","data-v-4a5de97a"]]);export{_t as default};
