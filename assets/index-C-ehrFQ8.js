import{P as A,_ as Qe,r as u,v as se,b as We,am as z,g as C,R as Xe,o as g,c as h,e as s,S as ne,l as oe,w as n,f as l,i as v,bj as Ye,aE as ie,h as y,bk as ue,k as re,F as ce,C as de,H as q,bl as Ze,x as ve,bm as pe,n as $,ag as me,al as Ce,bn as we,D as ke,E as ea,p as aa,q as la}from"./index-Bz8aCySx.js";function ge(f){const{pageNum:E,pageSize:U,type:N,parentId:r,name:o}=f,m={url:`/product/damage/page?pageNum=${E}&pageSize=${U}`,method:"post"},d={type:N};return r!=null&&(d.parentId=r),o&&(d.name=o),m.data=d,A(m)}function ta(f){return A({url:"/product/damage/add",method:"post",data:f})}function sa(f){return A({url:"/product/damage/edit",method:"post",data:f})}function na(f){return A({url:"/product/damage/del",method:"post",data:{id:f}})}const fe=f=>(aa("data-v-2b4da927"),f=f(),la(),f),oa={class:"injury-type-management"},ia={class:"classification-container"},ua={class:"card-header"},ra={class:"header-left"},ca=fe(()=>s("span",null,"备件材质",-1)),da={class:"search-box"},va={class:"search-row"},pa={class:"search-buttons"},ma={class:"item-list"},ga=["onClick"],fa={class:"item-content"},_a={class:"item-name"},ha={class:"item-actions"},ya={class:"pagination-wrapper"},za={class:"card-header"},Ca={class:"header-left"},wa=fe(()=>s("span",null,"损伤类型",-1)),ka={key:0,class:"empty-state"},Sa={key:1},ba={class:"search-box"},Na={class:"search-row"},xa={class:"search-buttons"},Va={class:"item-list"},La=["onClick"],Ma={class:"item-content"},Ia={class:"item-name"},Ta={class:"item-actions"},Da={class:"pagination-wrapper"},$a={class:"card-header"},Ua={class:"header-left"},Pa=fe(()=>s("span",null,"损伤程度",-1)),Ba={key:0,class:"empty-state"},Ea={key:1},Ka={class:"search-box"},Ra={class:"search-row"},qa={class:"search-buttons"},Aa={class:"item-list"},ja={class:"item-content"},Fa={class:"item-name"},Ha={class:"item-actions"},Ga={class:"pagination-wrapper"},Ja={class:"dialog-footer"},Oa={__name:"index",setup(f){const E=u([]),U=u([]),N=u([]),r=u(null),o=u(null),m=u({pageNum:1,pageSize:10,total:0}),d=u({pageNum:1,pageSize:10,total:0}),p=u({pageNum:1,pageSize:10,total:0}),j=u(!1),F=u(!1),H=u(!1),x=u(""),k=u(""),w=u(""),K=u(""),P=u(""),V=u(""),L=u(!1),G=u(""),_=u(""),J=u(""),O=u(null),Q=u(!1),M=u(),S=u({name:""}),Se={name:[{required:!0,message:"请输入名称",trigger:"blur"},{min:1,max:50,message:"名称长度在 1 到 50 个字符",trigger:"blur"}]},be=se(()=>{let a=E.value;return x.value&&(a=a.filter(e=>e.name.toLowerCase().includes(x.value.toLowerCase()))),a}),Ne=se(()=>{let a=U.value;return k.value&&(a=a.filter(e=>e.name.toLowerCase().includes(k.value.toLowerCase()))),a}),xe=se(()=>{let a=N.value;return w.value&&(a=a.filter(e=>e.name.toLowerCase().includes(w.value.toLowerCase()))),a});We(()=>{I()});const I=async()=>{try{j.value=!0;const a={type:0,pageNum:m.value.pageNum,pageSize:m.value.pageSize};x.value&&(a.name=x.value);const e=await ge(a);e.code===200?(E.value=e.rows||[],m.value.total=e.total||0):z.error(e.msg||"加载备件材质数据失败")}catch(a){console.error("加载备件材质数据失败:",a)}finally{j.value=!1}},T=async a=>{try{F.value=!0;const e={type:1,parentId:a,pageNum:d.value.pageNum,pageSize:d.value.pageSize};k.value&&(e.name=k.value);const i=await ge(e);i.code===200?(U.value=i.rows||[],d.value.total=i.total||0):z.error(i.msg||"加载损伤类型数据失败")}catch(e){console.error("加载损伤类型数据失败:",e)}finally{F.value=!1}},D=async a=>{try{H.value=!0;const e={type:2,parentId:a,pageNum:p.value.pageNum,pageSize:p.value.pageSize};w.value&&(e.name=w.value);const i=await ge(e);i.code===200?(N.value=i.rows||[],p.value.total=i.total||0):z.error(i.msg||"加载损伤程度数据失败")}catch(e){console.error("加载损伤程度数据失败:",e)}finally{H.value=!1}},Ve=async a=>{try{const e=await ta(a);return e.code===200?(z.success("添加成功"),await W(),!0):(z.error(e.msg||"添加失败"),!1)}catch(e){return console.error("添加损伤配置失败:",e),!1}},Le=async a=>{try{const e=await sa(a);return e.code===200?(z.success("更新成功"),await W(),!0):(z.error(e.msg||"更新失败"),!1)}catch(e){return console.error("编辑损伤配置失败:",e),!1}},W=async()=>{_.value==="material"?await I():_.value==="type"&&r.value?await T(r.value.id):_.value==="level"&&o.value&&await D(o.value.id)},Me=async a=>{r.value=a,o.value=null,U.value=[],N.value=[],d.value.pageNum=1,d.value.total=0,p.value.pageNum=1,p.value.total=0,k.value="",P.value="",w.value="",V.value="",a.id&&await T(a.id)},Ie=async a=>{o.value=a,N.value=[],p.value.pageNum=1,p.value.total=0,w.value="",V.value="",a.id&&await D(a.id)},X=a=>{if(a==="type"&&!r.value){z.warning("请先选择备件材质");return}if(a==="level"&&!o.value){z.warning("请先选择损伤类型");return}_.value=a,J.value="add",O.value=null;const e={material:"新增备件材质",type:"新增损伤类型",level:"新增损伤程度"};G.value=e[a],S.value={name:""},L.value=!0,ke(()=>{var i;(i=M.value)==null||i.clearValidate()})},Y=(a,e)=>{_.value=e,J.value="edit",O.value=a;const i={material:"编辑备件材质",type:"编辑损伤类型",level:"编辑损伤程度"};G.value=i[e],S.value={name:a.name||""},L.value=!0,ke(()=>{var c;(c=M.value)==null||c.clearValidate()})},Te=a=>{var e;(e=M.value)==null||e.clearValidate(),a()},De=async()=>{if(M.value)try{await M.value.validate(),Q.value=!0;let a=!1;J.value==="add"?a=await $e():a=await Ue(),a&&(L.value=!1,_.value==="material"?(r.value=null,o.value=null):_.value==="type"&&(o.value=null))}catch(a){console.error("表单验证失败:",a)}finally{Q.value=!1}},$e=async()=>{const a={name:S.value.name,parentId:Pe()};return await Ve(a)},Ue=async()=>{const a={id:O.value.id,name:S.value.name};return await Le(a)},Pe=()=>_.value==="material"?null:_.value==="type"&&r.value?r.value.id:_.value==="level"&&o.value?o.value.id:null,Z=async(a,e,i)=>ea.confirm(`确定删除 "${i}" 吗？此操作不可撤销。`,"删除确认",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}).then(async()=>{await na(a),z.success("删除成功"),e==="material"?(r.value=null,o.value=null):e==="type"&&(o.value=null),_.value=e,await W()}).catch(()=>{}),_e=()=>{x.value=K.value,m.value.pageNum=1,I()},Be=()=>{K.value="",x.value="",m.value.pageNum=1,I()},he=()=>{k.value=P.value,d.value.pageNum=1,r.value&&T(r.value.id)},Ee=()=>{P.value="",k.value="",d.value.pageNum=1,r.value&&T(r.value.id)},ye=()=>{w.value=V.value,p.value.pageNum=1,o.value&&D(o.value.id)},Ke=()=>{V.value="",w.value="",p.value.pageNum=1,o.value&&D(o.value.id)},Re=a=>{m.value.pageSize=a,m.value.pageNum=1,I()},qe=a=>{m.value.pageNum=a,I()},Ae=a=>{d.value.pageSize=a,d.value.pageNum=1,r.value&&T(r.value.id)},je=a=>{d.value.pageNum=a,r.value&&T(r.value.id)},Fe=a=>{p.value.pageSize=a,p.value.pageNum=1,o.value&&D(o.value.id)},He=a=>{p.value.pageNum=a,o.value&&D(o.value.id)};return(a,e)=>{const i=C("el-icon"),c=C("el-button"),R=C("el-input"),ee=C("el-scrollbar"),ae=C("el-pagination"),le=C("el-card"),ze=C("el-empty"),Ge=C("el-form-item"),Je=C("el-form"),Oe=C("el-dialog"),te=Xe("loading");return g(),h("div",oa,[s("div",ia,[ne((g(),oe(le,{class:"classification-card",shadow:"hover"},{header:n(()=>[s("div",ua,[s("div",ra,[l(i,null,{default:n(()=>[l(v(Ye))]),_:1}),ca]),l(c,{type:"primary",size:"small",onClick:e[0]||(e[0]=t=>X("material"))},{default:n(()=>[l(i,null,{default:n(()=>[l(v(ie))]),_:1}),y(" 新增材质 ")]),_:1})])]),default:n(()=>[s("div",da,[s("div",va,[l(R,{modelValue:K.value,"onUpdate:modelValue":e[1]||(e[1]=t=>K.value=t),placeholder:"搜索材质...","prefix-icon":v(ue),clearable:"",size:"small",onKeyup:re(_e,["enter"])},null,8,["modelValue","prefix-icon"]),s("div",pa,[l(c,{type:"primary",size:"small",onClick:_e},{default:n(()=>[y(" 查询 ")]),_:1}),l(c,{size:"small",onClick:Be},{default:n(()=>[y(" 重置 ")]),_:1})])])]),s("div",ma,[l(ee,{height:"calc(100vh - 280px)"},{default:n(()=>[(g(!0),h(ce,null,de(be.value,t=>{var b;return g(),h("div",{key:t.id,class:q(["list-item",{active:((b=r.value)==null?void 0:b.id)===t.id}]),onClick:B=>Me(t)},[s("div",fa,[l(i,{class:"item-icon"},{default:n(()=>[l(v(Ze))]),_:1}),s("span",_a,ve(t.name),1)]),s("div",ha,[l(c,{type:"primary",icon:v(pe),size:"small",circle:"",onClick:$(B=>Y(t,"material"),["stop"])},null,8,["icon","onClick"]),l(c,{type:"danger",icon:v(me),size:"small",circle:"",onClick:$(B=>Z(t.id,"material",t.name),["stop"])},null,8,["icon","onClick"])])],10,ga)}),128))]),_:1})]),s("div",ya,[l(ae,{"current-page":m.value.pageNum,"onUpdate:currentPage":e[2]||(e[2]=t=>m.value.pageNum=t),"page-size":m.value.pageSize,"onUpdate:pageSize":e[3]||(e[3]=t=>m.value.pageSize=t),"page-sizes":[10,20,50,100],small:!0,layout:"total, sizes, prev, pager, next",total:m.value.total,onSizeChange:Re,onCurrentChange:qe},null,8,["current-page","page-size","total"])])]),_:1})),[[te,j.value]]),ne((g(),oe(le,{class:q(["classification-card",{disabled:!r.value}]),shadow:"hover"},{header:n(()=>[s("div",za,[s("div",Ca,[l(i,null,{default:n(()=>[l(v(Ce))]),_:1}),wa]),l(c,{type:"primary",size:"small",onClick:e[4]||(e[4]=t=>X("type")),disabled:!r.value},{default:n(()=>[l(i,null,{default:n(()=>[l(v(ie))]),_:1}),y(" 新增类型 ")]),_:1},8,["disabled"])])]),default:n(()=>[r.value?(g(),h("div",Sa,[s("div",ba,[s("div",Na,[l(R,{modelValue:P.value,"onUpdate:modelValue":e[5]||(e[5]=t=>P.value=t),placeholder:"搜索损伤类型...","prefix-icon":v(ue),clearable:"",size:"small",onKeyup:re(he,["enter"])},null,8,["modelValue","prefix-icon"]),s("div",xa,[l(c,{type:"primary",size:"small",onClick:he},{default:n(()=>[y(" 查询 ")]),_:1}),l(c,{size:"small",onClick:Ee},{default:n(()=>[y(" 重置 ")]),_:1})])])]),s("div",Va,[l(ee,{height:"calc(100vh - 280px)"},{default:n(()=>[(g(!0),h(ce,null,de(Ne.value,t=>{var b;return g(),h("div",{key:t.id,class:q(["list-item",{active:((b=o.value)==null?void 0:b.id)===t.id}]),onClick:B=>Ie(t)},[s("div",Ma,[l(i,{class:"item-icon"},{default:n(()=>[l(v(Ce))]),_:1}),s("span",Ia,ve(t.name),1)]),s("div",Ta,[l(c,{type:"primary",icon:v(pe),size:"small",circle:"",onClick:$(B=>Y(t,"type"),["stop"])},null,8,["icon","onClick"]),l(c,{type:"danger",icon:v(me),size:"small",circle:"",onClick:$(B=>Z(t.id,"type",t.name),["stop"])},null,8,["icon","onClick"])])],10,La)}),128))]),_:1})]),s("div",Da,[l(ae,{"current-page":d.value.pageNum,"onUpdate:currentPage":e[6]||(e[6]=t=>d.value.pageNum=t),"page-size":d.value.pageSize,"onUpdate:pageSize":e[7]||(e[7]=t=>d.value.pageSize=t),"page-sizes":[10,20,50,100],small:!0,layout:"total, sizes, prev, pager, next",total:d.value.total,onSizeChange:Ae,onCurrentChange:je},null,8,["current-page","page-size","total"])])])):(g(),h("div",ka,[l(ze,{description:"请先选择备件材质"})]))]),_:1},8,["class"])),[[te,F.value]]),ne((g(),oe(le,{class:q(["classification-card",{disabled:!o.value}]),shadow:"hover"},{header:n(()=>[s("div",$a,[s("div",Ua,[l(i,null,{default:n(()=>[l(v(we))]),_:1}),Pa]),l(c,{type:"primary",size:"small",onClick:e[8]||(e[8]=t=>X("level")),disabled:!o.value},{default:n(()=>[l(i,null,{default:n(()=>[l(v(ie))]),_:1}),y(" 新增程度 ")]),_:1},8,["disabled"])])]),default:n(()=>[o.value?(g(),h("div",Ea,[s("div",Ka,[s("div",Ra,[l(R,{modelValue:V.value,"onUpdate:modelValue":e[9]||(e[9]=t=>V.value=t),placeholder:"搜索损伤程度...","prefix-icon":v(ue),clearable:"",size:"small",onKeyup:re(ye,["enter"])},null,8,["modelValue","prefix-icon"]),s("div",qa,[l(c,{type:"primary",size:"small",onClick:ye},{default:n(()=>[y(" 查询 ")]),_:1}),l(c,{size:"small",onClick:Ke},{default:n(()=>[y(" 重置 ")]),_:1})])])]),s("div",Aa,[l(ee,{height:"calc(100vh - 280px)"},{default:n(()=>[(g(!0),h(ce,null,de(xe.value,t=>(g(),h("div",{key:t.id,class:"list-item"},[s("div",ja,[l(i,{class:"item-icon"},{default:n(()=>[l(v(we))]),_:1}),s("span",Fa,ve(t.name),1)]),s("div",Ha,[l(c,{type:"primary",icon:v(pe),size:"small",circle:"",onClick:$(b=>Y(t,"level"),["stop"])},null,8,["icon","onClick"]),l(c,{type:"danger",icon:v(me),size:"small",circle:"",onClick:$(b=>Z(t.id,"level",t.name),["stop"])},null,8,["icon","onClick"])])]))),128))]),_:1})]),s("div",Ga,[l(ae,{"current-page":p.value.pageNum,"onUpdate:currentPage":e[10]||(e[10]=t=>p.value.pageNum=t),"page-size":p.value.pageSize,"onUpdate:pageSize":e[11]||(e[11]=t=>p.value.pageSize=t),"page-sizes":[10,20,50,100],small:!0,layout:"total, sizes, prev, pager, next",total:p.value.total,onSizeChange:Fe,onCurrentChange:He},null,8,["current-page","page-size","total"])])])):(g(),h("div",Ba,[l(ze,{description:"请先选择损伤类型"})]))]),_:1},8,["class"])),[[te,H.value]])]),l(Oe,{modelValue:L.value,"onUpdate:modelValue":e[14]||(e[14]=t=>L.value=t),title:G.value,width:"400px","before-close":Te},{footer:n(()=>[s("span",Ja,[l(c,{onClick:e[13]||(e[13]=t=>L.value=!1)},{default:n(()=>[y("取消")]),_:1}),l(c,{type:"primary",onClick:De,loading:Q.value},{default:n(()=>[y(" 确定 ")]),_:1},8,["loading"])])]),default:n(()=>[l(Je,{ref_key:"formRef",ref:M,model:S.value,rules:Se,"label-width":"80px"},{default:n(()=>[l(Ge,{label:"名称",prop:"name"},{default:n(()=>[l(R,{modelValue:S.value.name,"onUpdate:modelValue":e[12]||(e[12]=t=>S.value.name=t),placeholder:"请输入名称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Wa=Qe(Oa,[["__scopeId","data-v-2b4da927"]]);export{Wa as default};
