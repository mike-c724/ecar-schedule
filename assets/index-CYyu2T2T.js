import{F as I}from"./index-Cj0gErN3.js";import{a as O,r as z,b as L,e as M}from"./enterprise-C1aPl2sl.js";import{r as g,v as Z,g as i,o as c,c as A,f as a,w as n,i as t,h as C,F as S,C as N,l as V,m as j,B as K,z as G,t as H}from"./index-Bz8aCySx.js";const J={class:"app-container enterprise"},Q=G({name:"Enterprise"}),te=Object.assign(Q,{setup(W){const{proxy:d}=H(),{nature_enterprise:b,enterprise_status:_}=d.useDict("nature_enterprise","enterprise_status"),h=g(null),P=Z(()=>[{type:"input",label:"企业名称",prop:"enterpriseName",placeholder:"请输入企业名称"},{type:"select",label:"企业性质",prop:"natureEnterprise",placeholder:"请选择企业性质",options:b.value},{type:"select",label:"状态",prop:"enterpriseStatus",placeholder:"请选择状态",options:_.value}]),x=[{label:"序号",type:"index"},{prop:"enterpriseName",label:"企业名称"},{prop:"natureEnterprise",label:"企业性质",slot:"natureEnterprise"},{prop:"channelAdminAccount",label:"总账户"},{prop:"enterpriseStatus",label:"状态",slot:"enterpriseStatus"}],F=[{label:"编辑",action:"edit",icon:"EditPen"},{label:"重置密码",action:"resetPwd",icon:"Key"}],$=async({row:s,action:l})=>{l==="edit"?E("edit",s):l==="resetPwd"&&d.$prompt('请输入"'+s.enterpriseName+'"的新密码',"提示",{confirmButtonText:"确定",cancelButtonText:"取消",closeOnClickModal:!1,inputPattern:/^[A-Za-z0-9]{6,17}$/,inputErrorMessage:"请录入6-17位大小写字母及数字",inputValidator:o=>{if(/<|>|"|'|\||\\/.test(o))return`不能包含非法字符：< > " ' \\ |`}}).then(({value:o})=>{const m={channelEnterpriseId:s.channelEnterpriseId,channelAdminPassword:o,userId:s.enterpriseUserId};z(m).then(u=>{d.$modal.msgSuccess("修改成功，新密码是："+o)})}).catch(()=>{})},p=g(!1),f=g("add"),v=g(null),r=g({enterpriseName:"",natureEnterprise:"",enterpriseStatus:"",channeldAdminAccount:"",channeldAdminPassword:"",remark:""}),U={enterpriseName:[{required:!0,message:"请输入企业名称",trigger:"blur"}],natureEnterprise:[{required:!0,message:"请选择企业性质",trigger:"change"}],enterpriseStatus:[{required:!0,message:"请选择状态",trigger:"change"}],channelAdminAccount:[{required:!0,message:"请输入总账号",trigger:"blur"},{pattern:/^[a-zA-Z0-9]{6,15}$/,message:"总账户必须是6-15位字母或数字",trigger:"blur"}],channelAdminPassword:[{required:!0,message:"请输入密码",trigger:"blur"},{pattern:/^[A-Za-z0-9]{6,17}$/,message:"请录入6-17位大小写字母及数字",trigger:"blur"}]},E=(s="add",l={})=>{f.value=s,p.value=!0,s==="edit"&&(r.value={...l})},T=()=>{r.value={enterpriseName:"",natureEnterprise:"",enterpriseStatus:"",channelAdminAccount:"",channelAdminPassword:"",remark:""},v.value.resetFields()},B=()=>{p.value=!1},R=async s=>{if(!s)return;if(!await s.validate(o=>!!o))return!1;d.$modal.loading();try{f.value==="add"?await L(r.value):await M(r.value),h.value.getList(),p.value=!1;const o=f.value==="add"?"新增企业":"编辑企业";d.$modal.msgSuccess(`${o}成功`)}catch(o){console.error("验证或请求失败:",o)}finally{d.$modal.closeLoading()}};return(s,l)=>{const o=i("dict-tag"),m=i("el-input"),u=i("el-form-item"),k=i("el-option"),y=i("el-select"),q=i("el-form"),w=i("el-button"),D=i("el-dialog");return c(),A("div",J,[a(t(I),{ref_key:"formTableRef",ref:h,"form-config":t(P),"table-columns":x,operations:F,showAdd:!0,api:t(O),onAdd:E,onOperation:$},{"table-natureEnterprise":n(({row:e})=>[a(o,{options:t(b),value:e.natureEnterprise},null,8,["options","value"])]),"table-enterpriseStatus":n(({row:e})=>[a(o,{options:t(_),value:e.enterpriseStatus},null,8,["options","value"])]),_:1},8,["form-config","api"]),a(D,{title:t(f)==="add"?"新增企业":"编辑企业",modelValue:t(p),"onUpdate:modelValue":l[7]||(l[7]=e=>K(p)?p.value=e:null),width:"500","close-on-click-modal":!1,onClose:T},{footer:n(()=>[a(w,{onClick:B},{default:n(()=>[C("取 消")]),_:1}),a(w,{type:"primary",onClick:l[6]||(l[6]=e=>R(t(v)))},{default:n(()=>[C("确 定")]),_:1})]),default:n(()=>[a(q,{ref_key:"dialogFormRef",ref:v,model:t(r),rules:U,"label-width":"100px"},{default:n(()=>[a(u,{label:"企业名称",prop:"enterpriseName"},{default:n(()=>[a(m,{modelValue:t(r).enterpriseName,"onUpdate:modelValue":l[0]||(l[0]=e=>t(r).enterpriseName=e),placeholder:"请输入企业名称"},null,8,["modelValue"])]),_:1}),a(u,{label:"企业性质",prop:"natureEnterprise"},{default:n(()=>[a(y,{modelValue:t(r).natureEnterprise,"onUpdate:modelValue":l[1]||(l[1]=e=>t(r).natureEnterprise=e),placeholder:"请选择企业性质"},{default:n(()=>[(c(!0),A(S,null,N(t(b),e=>(c(),V(k,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(u,{label:"总账户",prop:"channelAdminAccount"},{default:n(()=>[a(m,{modelValue:t(r).channelAdminAccount,"onUpdate:modelValue":l[2]||(l[2]=e=>t(r).channelAdminAccount=e),placeholder:"请输入总账户"},null,8,["modelValue"])]),_:1}),t(f)==="add"?(c(),V(u,{key:0,label:"总账户密码",prop:"channelAdminPassword"},{default:n(()=>[a(m,{modelValue:t(r).channelAdminPassword,"onUpdate:modelValue":l[3]||(l[3]=e=>t(r).channelAdminPassword=e),placeholder:"请输入总账户密码"},null,8,["modelValue"])]),_:1})):j("",!0),a(u,{label:"状态",prop:"enterpriseStatus"},{default:n(()=>[a(y,{modelValue:t(r).enterpriseStatus,"onUpdate:modelValue":l[4]||(l[4]=e=>t(r).enterpriseStatus=e),placeholder:"请选择状态"},{default:n(()=>[(c(!0),A(S,null,N(t(_),e=>(c(),V(k,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(u,{label:"备注",prop:"remark"},{default:n(()=>[a(m,{type:"textarea",modelValue:t(r).remark,"onUpdate:modelValue":l[5]||(l[5]=e=>t(r).remark=e),placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])}}});export{te as default};
