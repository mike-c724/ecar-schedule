import{_ as fe,a as ke,a8 as _e,r as f,g as k,o,c as i,f as p,w as v,e as h,x as _,l as m,m as d,S as G,h as P,T as J,F as R,C as $,H as K,i as ge,t as Ce,D as we,am as ye}from"./index-Bz8aCySx.js";import{$ as x}from"./index-CXdL54YQ.js";import{e as Z}from"./jsencrypt-DU2LWEeB.js";import"./jsencrypt.min-C2S-MpmI.js";const be={class:"card-header"},je={class:"out-tab-wrapper"},Ie={key:0,class:"btn-wrapper"},Re={key:1,class:"result-pic-wrapper"},$e={class:"result-pic-text"},xe=["onClick"],Te={key:2,class:"bottom-pic-wrapper"},De={class:"image-group-title"},Pe={class:"child-pic-wrapper"},Be={class:"result-pic-text"},Ne=["onClick"],Ve={key:3,class:"bottom-pic-wrapper"},Se={class:"image-group-title"},Ee={class:"child-pic-wrapper"},Fe={class:"result-pic-text"},ze=["onClick"],Le={class:"dialog-footer"},Me={__name:"NormalPicShow",props:{isRejected:{type:Boolean,default:!1},hasDownload:{type:Boolean,default:!0},hasRecord:{type:Boolean,default:!1},templateType:{type:Number,default:null}},setup(I){ke();const y=I,g=_e("orderId"),ee=t=>t.photoDict?N.useDict(t.photoDict)[t.photoDict].value:[{label:"其他信息",value:"other",elTagType:"default"}],B=f(!1),{proxy:N}=Ce(),{detect_bearing:te,general_image_evaluation:Q,standard_photo:ae}=N.useDict("detect_bearing","general_image_evaluation","standard_photo"),r=f(1),V=f(""),C=f([]),u=f([]),b=f([]),E=(t,e)=>{console.log(e);let a=t.map(s=>{var n;return(n=Q.value.find(T=>s===T.value))==null?void 0:n.label}).join("、")+(e||"");return a.length>12?`${a.slice(0,12)}...`:a},le=t=>t.map(a=>{var s;return(s=Q.value.find(n=>a===n.value))==null?void 0:s.label}).join("、"),S=f([]),F=t=>{w.value=!1,t===1?oe():t===2?se():t===3?(V.value=S.value[0].id,W(S.value[0].id)):t===4?X():t===5&&ce()},W=(t,e)=>{we(()=>{ne()})},oe=()=>{const t=y.isRejected?"getBaseRejectPhoto":"getBasePhoto";x[t](g).then(e=>{u.value=e.data})},se=()=>{const t=y.isRejected?"getStandardRejectPhoto":"getStandardPhoto";x[t](g).then(e=>{u.value=e.data})},ne=()=>{x.getBearingDetectionPhoto(g,V.value,y.isRejected?1:0).then(t=>{u.value=t.data.map(e=>({name:e.groupName,pic:e.assessmentPhotoList}))})},ce=()=>{X()},X=()=>{x.getBearingDetectionPhotoInfo({orderId:g,isReject:y.isRejected?1:0}).then(t=>{let e=new Map;for(let s=0;s<t.data.length;s++){const n=t.data[s];e.get(`${n.planRow}-${n.planColumn}`)?e.get(`${n.planRow}-${n.planColumn}`).push(n.orderPhoto):e.set(`${n.planRow}-${n.planColumn}`,[n.orderPhoto])}let a=[];e.forEach((s,n)=>{console.log(n,s),a.push({name:n,pic:s})}),b.value=a.reverse()})},ie=()=>{const t=y.isRejected?"getEvaluationStructureReject":"getEvaluationStructure";x[t](g).then(async e=>{C.value=e.data.map(a=>+a.slice(-1)+1),C.value.includes(3)?x.getBearingDetectionTabs(g,y.isRejected).then(a=>{S.value=a.data.map(s=>{var n;return{id:s,name:(n=te.value.find(T=>s===T.value))==null?void 0:n.label}}),r.value=C.value[0],F(r.value)}):(r.value=C.value[0],F(r.value))})},w=f(!1),re=f([]),de=()=>{if(y.templateType==1){const t=Z(g);window.open(`${window.location.origin}/evaluationManagement/record/view/${t}`)}else if(y.templateType==2){const t=Z(g);window.open(`${window.location.origin}/evaluationManagement/chassisReport/view/${t}`)}else N.$message.error("无此类型报告")},ue=()=>{[1,2].includes(r.value)?u.value.map(t=>{t.isChecked=!1}):[3].includes(r.value)?u.value.map(t=>{t.pic.map(e=>{e.isChecked=!1})}):b.value.map(t=>{t.pic.map(e=>{e.isChecked=!1})})},z=f({}),L=t=>{z.value=t,B.value=!0},pe=t=>{let e=[];if([1,2].includes(r.value))e=u.value.filter(a=>a.isChecked).map(a=>a.orderPhotoId);else if([3].includes(r.value))for(let a=0;a<u.value.length;a++)for(let s=0;s<u.value[a].pic.length;s++)u.value[a].pic[s].isChecked&&e.push(u.value[a].pic[s].orderPhotoId);else if([4].includes(r.value))for(let a=0;a<b.value.length;a++)for(let s=0;s<b.value[a].pic.length;s++)b.value[a].pic[s].isChecked&&e.push(b.value[a].pic[s].orderPhotoId);if(e.length===0){ye.warning("请选择下载的图片");return}N.download("/order/common/order-photo/download",{orderId:g,phototIdList:e},`图片下载_${new Date().getTime()}.zip`,{headers:{"Content-Type":"application/json",timeout:6e4}},!1)},ve=t=>{w.value=!1,[1,2].includes(r.value)?u.value.map(e=>{e.isChecked=!1}):[3].includes(r.value)?u.value.map(e=>{e.pic.map(a=>{a.isChecked=!1})}):b.value.map(e=>{e.pic.map(a=>{a.isChecked=!1})}),re.value=[]},M=t=>{w.value&&(t.isChecked=!t.isChecked)},U=t=>t.map(e=>e.photoOriginal);return ie(),(t,e)=>{const a=k("el-tab-pane"),s=k("el-tabs"),n=k("el-button"),T=k("el-space"),O=k("el-image"),A=k("CircleCheckFilled"),H=k("el-icon"),Y=k("dict-tag"),he=k("el-card"),me=k("el-dialog");return o(),i(R,null,[p(he,{class:"box-card"},{header:v(()=>[h("div",be,[h("span",null,_(I.isRejected?"驳回":"通用")+"图片",1)])]),default:v(()=>[h("div",je,[p(s,{modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=l=>r.value=l),class:"demo-tabs",onTabChange:F},{default:v(()=>[C.value.includes(1)?(o(),m(a,{key:0,label:"基础资料",name:1})):d("",!0),C.value.includes(2)?(o(),m(a,{key:1,label:"标准图片",name:2})):d("",!0),C.value.includes(3)?(o(),m(a,{key:2,label:"车身",name:3})):d("",!0),C.value.includes(4)?(o(),m(a,{key:3,label:"底盘",name:4})):d("",!0),C.value.includes(6)?(o(),m(a,{key:4,label:"新能源底盘",name:5})):d("",!0)]),_:1},8,["modelValue"]),I.hasDownload?(o(),i("div",Ie,[p(T,{class:"left-btn"},{default:v(()=>[G(p(n,{type:"primary",onClick:e[1]||(e[1]=l=>ue())},{default:v(()=>[P("取消选中")]),_:1},512),[[J,w.value]]),G(p(n,{type:"primary",onClick:e[2]||(e[2]=l=>pe())},{default:v(()=>[P("下载")]),_:1},512),[[J,w.value]]),G(p(n,{type:"primary",onClick:e[3]||(e[3]=l=>ve())},{default:v(()=>[P("取消")]),_:1},512),[[J,w.value]])]),_:1}),I.hasRecord?(o(),m(n,{key:0,type:"primary",onClick:de},{default:v(()=>[P("查看报告")]),_:1})):d("",!0)])):d("",!0),[1,2].includes(r.value)?(o(),i("div",Re,[(o(!0),i(R,null,$(u.value,(l,j)=>(o(),i("div",{class:"image__preview-out",key:j},[p(O,{style:{width:"100%",height:"160px"},src:l.photoMiddle,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"initial-index":j,"preview-src-list":w.value?[]:U(u.value),fit:"fill",class:K(l.isChecked&&"pic-checked"),onClick:c=>M(l)},null,8,["src","initial-index","preview-src-list","class","onClick"]),l.isChecked?(o(),m(H,{key:0,color:"#409EFF",size:"24",class:"checked-icon"},{default:v(()=>[p(A)]),_:1})):d("",!0),h("div",$e,[[1].includes(r.value)?(o(),m(Y,{key:0,options:ee(l),value:l.photoName},null,8,["options","value"])):d("",!0),[2].includes(r.value)?(o(),m(Y,{key:1,options:ge(ae),value:l==null?void 0:l.photoName},null,8,["options","value"])):d("",!0),I.isRejected&&l.rejectedItem?(o(),i("div",{key:2,class:"color-2 center",onClick:c=>L(l)},_(E(l.rejectedItem.rejectedItem,l.rejectedItem.rejectedRemark)),9,xe)):d("",!0)])]))),128))])):d("",!0),[3].includes(r.value)?(o(),i("div",Te,[p(s,{modelValue:V.value,"onUpdate:modelValue":e[4]||(e[4]=l=>V.value=l),onTabClick:W},{default:v(()=>[(o(!0),i(R,null,$(S.value,(l,j)=>(o(),m(a,{label:l.name,name:l.id,key:j},null,8,["label","name"]))),128))]),_:1},8,["modelValue"]),(o(!0),i(R,null,$(u.value,(l,j)=>(o(),i("div",{class:"bottom-pic-group",key:j},[h("div",De,_(l.name),1),h("div",Pe,[(o(!0),i(R,null,$(l.pic,(c,D)=>(o(),i("div",{class:"image__preview-out",key:D},[p(O,{style:{width:"100%",height:"160px"},src:c.photoMiddle,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"initial-index":D,"preview-src-list":w.value?[]:U(l.pic),fit:"fill",class:K(c.isChecked&&"pic-checked"),onClick:q=>M(c)},null,8,["src","initial-index","preview-src-list","class","onClick"]),c.isChecked?(o(),m(H,{key:0,color:"#409EFF",size:"24",class:"checked-icon"},{default:v(()=>[p(A)]),_:1})):d("",!0),h("div",Be,_(c.photoName),1),I.isRejected&&c.rejectedItem?(o(),i("div",{key:1,class:"color-2 center",onClick:q=>L(c)},_(E(c.rejectedItem.rejectedItem,c.rejectedItem.rejectedRemark)),9,Ne)):d("",!0)]))),128))])]))),128))])):d("",!0),[4,5].includes(r.value)?(o(),i("div",Ve,[(o(!0),i(R,null,$(b.value,(l,j)=>(o(),i("div",{class:"bottom-pic-group",key:j},[h("div",Se,_(l.name),1),h("div",Ee,[(o(!0),i(R,null,$(l.pic,(c,D)=>(o(),i("div",{class:"image__preview-out",key:D},[p(O,{style:{width:"100%",height:"160px"},src:c.photoMiddle,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"initial-index":D,"preview-src-list":w.value?[]:U(l.pic),fit:"cover",class:K(c.isChecked&&"pic-checked"),onClick:q=>M(c)},null,8,["src","initial-index","preview-src-list","class","onClick"]),c.isChecked?(o(),m(H,{key:0,color:"#409EFF",size:"24",class:"checked-icon"},{default:v(()=>[p(A)]),_:1})):d("",!0),h("div",Fe,[h("div",null,_(c.photoName),1),I.isRejected&&c.rejectedItem?(o(),i("div",{key:0,class:"color-2 center",onClick:q=>L(c)},_(E(c.rejectedItem.rejectedItem,c.rejectedItem.rejectedRemark)),9,ze)):d("",!0)])]))),128))])]))),128))])):d("",!0)])]),_:1}),p(me,{modelValue:B.value,"onUpdate:modelValue":e[6]||(e[6]=l=>B.value=l),title:"驳回原因",width:"30%"},{footer:v(()=>[h("span",Le,[p(n,{onClick:e[5]||(e[5]=l=>B.value=!1)},{default:v(()=>[P("关闭")]),_:1})])]),default:v(()=>[h("div",null,_(le(z.value.rejectedItem.rejectedItem)),1),h("div",null,_(z.value.rejectedItem.rejectedRemark),1)]),_:1},8,["modelValue"])],64)}}},qe=fe(Me,[["__scopeId","data-v-6be43f91"]]);export{qe as default};
