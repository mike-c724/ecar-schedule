import{a as Ye,r as _,A as te,aD as Qe,U as je,a0 as He,g as d,R as ae,o as s,c as S,f as l,w as t,e as k,i as a,B as L,S as y,k as ne,F as T,C as D,l as r,h as v,T as oe,m as h,x as ue,z as Ge,t as Je}from"./index-CBERRbij.js";import{e as We,l as Xe,f as Ze,h as el,r as ll,i as se,j as tl,k as al}from"./user-erS4FSi2.js";const nl={class:"app-container"},ol={class:"head-container"},ul={class:"head-container"},sl={class:"dialog-footer"},dl=k("div",{class:"el-upload__text"},[v("将文件拖到此处，或"),k("em",null,"点击上传")],-1),rl={class:"el-upload__tip text-center"},il={class:"el-upload__tip"},pl=k("span",null,"仅允许导入xls、xlsx格式文件。",-1),ml={class:"dialog-footer"},cl=Ge({name:"User"}),gl=Object.assign(cl,{setup(fl){const de=Ye(),{proxy:i}=Je(),{sys_normal_disable:H,sys_user_sex:re}=i.useDict("sys_normal_disable","sys_user_sex"),G=_([]),x=_(!1),O=_(!0),P=_(!0),E=_([]),J=_(!0),W=_(!0),K=_(0),M=_(""),$=_([]),F=_(""),A=_(void 0),ie=_(void 0),Y=_([]),Q=_([]),b=te({open:!1,title:"",isUploading:!1,updateSupport:0,headers:{Authorization:"Bearer "+Qe()},url:"/prod-api/system/user/importData"}),I=_([{key:0,label:"用户编号",visible:!0},{key:1,label:"用户名称",visible:!0},{key:2,label:"用户昵称",visible:!0},{key:3,label:"部门",visible:!0},{key:4,label:"手机号码",visible:!0},{key:5,label:"状态",visible:!0},{key:6,label:"创建时间",visible:!0}]),pe=te({form:{},queryParams:{pageNum:1,pageSize:10,userName:void 0,phonenumber:void 0,status:void 0,deptId:void 0},rules:{userName:[{required:!0,message:"用户名称不能为空",trigger:"blur"},{min:2,max:20,message:"用户名称长度必须介于 2 和 20 之间",trigger:"blur"}],nickName:[{required:!0,message:"用户昵称不能为空",trigger:"blur"}],password:[{required:!0,message:"用户密码不能为空",trigger:"blur"},{min:5,max:20,message:"用户密码长度必须介于 5 和 20 之间",trigger:"blur"},{pattern:/^[^<>"'|\\]+$/,message:`不能包含非法字符：< > " ' \\ |`,trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:["blur","change"]}],phonenumber:[{pattern:/^1[3|4|5|6|7|8|9][0-9]\d{8}$/,message:"请输入正确的手机号码",trigger:"blur"}]}}),{queryParams:c,form:u,rules:me}=je(pe),ce=(o,n)=>o?n.label.indexOf(o)!==-1:!0;He(F,o=>{i.$refs.deptTreeRef.filter(o)});function fe(){We().then(o=>{A.value=o.data})}function U(){O.value=!0,Xe(i.addDateRange(c.value,$.value)).then(o=>{O.value=!1,G.value=o.rows,K.value=o.total})}function _e(o){c.value.deptId=o.id,R()}function R(){c.value.pageNum=1,U()}function be(){$.value=[],i.resetForm("queryRef"),c.value.deptId=void 0,i.$refs.deptTreeRef.setCurrentKey(null),R()}function X(o){const n=o.userId||E.value;i.$modal.confirm('是否确认删除用户编号为"'+n+'"的数据项？').then(function(){return Ze(n)}).then(()=>{U(),i.$modal.msgSuccess("删除成功")}).catch(()=>{})}function ge(){i.download("system/user/export",{...c.value},`user_${new Date().getTime()}.xlsx`)}function ve(o){let n=o.status==="0"?"启用":"停用";i.$modal.confirm('确认要"'+n+'""'+o.userName+'"用户吗?').then(function(){return el(o.userId,o.status)}).then(()=>{i.$modal.msgSuccess(n+"成功")}).catch(function(){o.status=o.status==="0"?"1":"0"})}function he(o){const n=o.userId;de.push("/system/user-auth/role/"+n)}function ye(o){i.$prompt('请输入"'+o.userName+'"的新密码',"提示",{confirmButtonText:"确定",cancelButtonText:"取消",closeOnClickModal:!1,inputPattern:/^.{5,20}$/,inputErrorMessage:"用户密码长度必须介于 5 和 20 之间",inputValidator:n=>{if(/<|>|"|'|\||\\/.test(n))return`不能包含非法字符：< > " ' \\ |`}}).then(({value:n})=>{ll(o.userId,n).then(p=>{i.$modal.msgSuccess("修改成功，新密码是："+n)})}).catch(()=>{})}function ke(o){E.value=o.map(n=>n.userId),J.value=o.length!=1,W.value=!o.length}function Ve(){b.title="用户导入",b.open=!0}function we(){i.download("system/user/importTemplate",{},`user_template_${new Date().getTime()}.xlsx`)}const xe=(o,n,p)=>{b.isUploading=!0},Ie=(o,n,p)=>{b.open=!1,b.isUploading=!1,i.$refs.uploadRef.handleRemove(n),i.$alert("<div style='overflow: auto;overflow-x: hidden;max-height: 70vh;padding: 10px 20px 0;'>"+o.msg+"</div>","导入结果",{dangerouslyUseHTMLString:!0}),U()};function Ue(){i.$refs.uploadRef.submit()}function j(){u.value={userId:void 0,deptId:void 0,userName:void 0,nickName:void 0,password:void 0,phonenumber:void 0,email:void 0,sex:void 0,status:"0",remark:void 0,postIds:[],roleIds:[]},i.resetForm("userRef")}function Ce(){x.value=!1,j()}function Ne(){j(),se().then(o=>{Y.value=o.posts,Q.value=o.roles,x.value=!0,M.value="添加用户",u.value.password=ie.value})}function Z(o){j();const n=o.userId||E.value;se(n).then(p=>{u.value=p.data,Y.value=p.posts,Q.value=p.roles,u.value.postIds=p.postIds,u.value.roleIds=p.roleIds,x.value=!0,M.value="修改用户",u.password=""})}function Se(){i.$refs.userRef.validate(o=>{o&&(u.value.userId!=null?tl(u.value).then(n=>{i.$modal.msgSuccess("修改成功"),x.value=!1,U()}):al(u.value).then(n=>{i.$modal.msgSuccess("新增成功"),x.value=!1,U()}))})}return fe(),U(),(o,n)=>{const p=d("el-input"),$e=d("el-tree"),m=d("el-col"),f=d("el-form-item"),B=d("el-option"),q=d("el-select"),Re=d("el-date-picker"),g=d("el-button"),ee=d("el-form"),Te=d("right-toolbar"),C=d("el-row"),V=d("el-table-column"),De=d("el-switch"),z=d("el-tooltip"),Pe=d("el-table"),Fe=d("pagination"),Be=d("el-tree-select"),qe=d("el-radio"),ze=d("el-radio-group"),le=d("el-dialog"),Le=d("upload-filled"),Oe=d("el-icon"),Ee=d("el-checkbox"),Ke=d("el-link"),Me=d("el-upload"),w=ae("hasPermi"),Ae=ae("loading");return s(),S("div",nl,[l(C,{gutter:20},{default:t(()=>[l(m,{span:4,xs:24},{default:t(()=>[k("div",ol,[l(p,{modelValue:a(F),"onUpdate:modelValue":n[0]||(n[0]=e=>L(F)?F.value=e:null),placeholder:"请输入部门名称",clearable:"","prefix-icon":"Search",style:{"margin-bottom":"20px"}},null,8,["modelValue"])]),k("div",ul,[l($e,{data:a(A),props:{label:"label",children:"children"},"expand-on-click-node":!1,"filter-node-method":ce,ref:"deptTreeRef","node-key":"id","highlight-current":"","default-expand-all":"",onNodeClick:_e},null,8,["data"])])]),_:1}),l(m,{span:20,xs:24},{default:t(()=>[y(l(ee,{model:a(c),ref:"queryRef",inline:!0,"label-width":"68px"},{default:t(()=>[l(f,{label:"用户名称",prop:"userName"},{default:t(()=>[l(p,{modelValue:a(c).userName,"onUpdate:modelValue":n[1]||(n[1]=e=>a(c).userName=e),placeholder:"请输入用户名称",clearable:"",style:{width:"240px"},onKeyup:ne(R,["enter"])},null,8,["modelValue"])]),_:1}),l(f,{label:"手机号码",prop:"phonenumber"},{default:t(()=>[l(p,{modelValue:a(c).phonenumber,"onUpdate:modelValue":n[2]||(n[2]=e=>a(c).phonenumber=e),placeholder:"请输入手机号码",clearable:"",style:{width:"240px"},onKeyup:ne(R,["enter"])},null,8,["modelValue"])]),_:1}),l(f,{label:"状态",prop:"status"},{default:t(()=>[l(q,{modelValue:a(c).status,"onUpdate:modelValue":n[3]||(n[3]=e=>a(c).status=e),placeholder:"用户状态",clearable:"",style:{width:"240px"}},{default:t(()=>[(s(!0),S(T,null,D(a(H),e=>(s(),r(B,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(f,{label:"创建时间",style:{width:"308px"}},{default:t(()=>[l(Re,{modelValue:a($),"onUpdate:modelValue":n[4]||(n[4]=e=>L($)?$.value=e:null),"value-format":"YYYY-MM-DD",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])]),_:1}),l(f,null,{default:t(()=>[l(g,{type:"primary",icon:"Search",onClick:R},{default:t(()=>[v("搜索")]),_:1}),l(g,{icon:"Refresh",onClick:be},{default:t(()=>[v("重置")]),_:1})]),_:1})]),_:1},8,["model"]),[[oe,a(P)]]),l(C,{gutter:10,class:"mb8"},{default:t(()=>[l(m,{span:1.5},{default:t(()=>[y((s(),r(g,{type:"primary",plain:"",icon:"Plus",onClick:Ne},{default:t(()=>[v("新增")]),_:1})),[[w,["system:user:add"]]])]),_:1}),l(m,{span:1.5},{default:t(()=>[y((s(),r(g,{type:"success",plain:"",icon:"Edit",disabled:a(J),onClick:Z},{default:t(()=>[v("修改")]),_:1},8,["disabled"])),[[w,["system:user:edit"]]])]),_:1}),l(m,{span:1.5},{default:t(()=>[y((s(),r(g,{type:"danger",plain:"",icon:"Delete",disabled:a(W),onClick:X},{default:t(()=>[v("删除")]),_:1},8,["disabled"])),[[w,["system:user:remove"]]])]),_:1}),l(m,{span:1.5},{default:t(()=>[y((s(),r(g,{type:"info",plain:"",icon:"Upload",onClick:Ve},{default:t(()=>[v("导入")]),_:1})),[[w,["system:user:import"]]])]),_:1}),l(m,{span:1.5},{default:t(()=>[y((s(),r(g,{type:"warning",plain:"",icon:"Download",onClick:ge},{default:t(()=>[v("导出")]),_:1})),[[w,["system:user:export"]]])]),_:1}),l(Te,{showSearch:a(P),"onUpdate:showSearch":n[5]||(n[5]=e=>L(P)?P.value=e:null),onQueryTable:U,columns:a(I)},null,8,["showSearch","columns"])]),_:1}),y((s(),r(Pe,{data:a(G),onSelectionChange:ke},{default:t(()=>[l(V,{type:"selection",width:"50",align:"center"}),a(I)[0].visible?(s(),r(V,{label:"用户编号",align:"center",key:"userId",prop:"userId"})):h("",!0),a(I)[1].visible?(s(),r(V,{label:"用户名称",align:"center",key:"userName",prop:"userName","show-overflow-tooltip":!0})):h("",!0),a(I)[2].visible?(s(),r(V,{label:"用户昵称",align:"center",key:"nickName",prop:"nickName","show-overflow-tooltip":!0})):h("",!0),a(I)[3].visible?(s(),r(V,{label:"部门",align:"center",key:"deptName",prop:"dept.deptName","show-overflow-tooltip":!0})):h("",!0),a(I)[4].visible?(s(),r(V,{label:"手机号码",align:"center",key:"phonenumber",prop:"phonenumber",width:"120"})):h("",!0),a(I)[5].visible?(s(),r(V,{label:"状态",align:"center",key:"status"},{default:t(e=>[l(De,{modelValue:e.row.status,"onUpdate:modelValue":N=>e.row.status=N,"active-value":"0","inactive-value":"1",onChange:N=>ve(e.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1})):h("",!0),a(I)[6].visible?(s(),r(V,{key:6,label:"创建时间",align:"center",prop:"createTime",width:"160"},{default:t(e=>[k("span",null,ue(o.parseTime(e.row.createTime)),1)]),_:1})):h("",!0),l(V,{label:"操作",align:"center",width:"150","class-name":"small-padding fixed-width"},{default:t(e=>[e.row.userId!==1?(s(),r(z,{key:0,content:"修改",placement:"top"},{default:t(()=>[y(l(g,{link:"",type:"primary",icon:"Edit",onClick:N=>Z(e.row)},null,8,["onClick"]),[[w,["system:user:edit"]]])]),_:2},1024)):h("",!0),e.row.userId!==1?(s(),r(z,{key:1,content:"删除",placement:"top"},{default:t(()=>[y(l(g,{link:"",type:"primary",icon:"Delete",onClick:N=>X(e.row)},null,8,["onClick"]),[[w,["system:user:remove"]]])]),_:2},1024)):h("",!0),e.row.userId!==1?(s(),r(z,{key:2,content:"重置密码",placement:"top"},{default:t(()=>[y(l(g,{link:"",type:"primary",icon:"Key",onClick:N=>ye(e.row)},null,8,["onClick"]),[[w,["system:user:resetPwd"]]])]),_:2},1024)):h("",!0),e.row.userId!==1?(s(),r(z,{key:3,content:"分配角色",placement:"top"},{default:t(()=>[y(l(g,{link:"",type:"primary",icon:"CircleCheck",onClick:N=>he(e.row)},null,8,["onClick"]),[[w,["system:user:edit"]]])]),_:2},1024)):h("",!0)]),_:1})]),_:1},8,["data"])),[[Ae,a(O)]]),y(l(Fe,{total:a(K),page:a(c).pageNum,"onUpdate:page":n[6]||(n[6]=e=>a(c).pageNum=e),limit:a(c).pageSize,"onUpdate:limit":n[7]||(n[7]=e=>a(c).pageSize=e),onPagination:U},null,8,["total","page","limit"]),[[oe,a(K)>0]])]),_:1})]),_:1}),l(le,{title:a(M),modelValue:a(x),"onUpdate:modelValue":n[19]||(n[19]=e=>L(x)?x.value=e:null),width:"600px","append-to-body":""},{footer:t(()=>[k("div",sl,[l(g,{type:"primary",onClick:Se},{default:t(()=>[v("确 定")]),_:1}),l(g,{onClick:Ce},{default:t(()=>[v("取 消")]),_:1})])]),default:t(()=>[l(ee,{model:a(u),rules:a(me),ref:"userRef","label-width":"80px"},{default:t(()=>[l(C,null,{default:t(()=>[l(m,{span:12},{default:t(()=>[l(f,{label:"用户昵称",prop:"nickName"},{default:t(()=>[l(p,{modelValue:a(u).nickName,"onUpdate:modelValue":n[8]||(n[8]=e=>a(u).nickName=e),placeholder:"请输入用户昵称",maxlength:"30"},null,8,["modelValue"])]),_:1})]),_:1}),l(m,{span:12},{default:t(()=>[l(f,{label:"归属部门",prop:"deptId"},{default:t(()=>[l(Be,{modelValue:a(u).deptId,"onUpdate:modelValue":n[9]||(n[9]=e=>a(u).deptId=e),data:a(A),props:{value:"id",label:"label",children:"children"},"value-key":"id",placeholder:"请选择归属部门","check-strictly":""},null,8,["modelValue","data"])]),_:1})]),_:1})]),_:1}),l(C,null,{default:t(()=>[l(m,{span:12},{default:t(()=>[l(f,{label:"手机号码",prop:"phonenumber"},{default:t(()=>[l(p,{modelValue:a(u).phonenumber,"onUpdate:modelValue":n[10]||(n[10]=e=>a(u).phonenumber=e),placeholder:"请输入手机号码",maxlength:"11"},null,8,["modelValue"])]),_:1})]),_:1}),l(m,{span:12},{default:t(()=>[l(f,{label:"邮箱",prop:"email"},{default:t(()=>[l(p,{modelValue:a(u).email,"onUpdate:modelValue":n[11]||(n[11]=e=>a(u).email=e),placeholder:"请输入邮箱",maxlength:"50"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(C,null,{default:t(()=>[l(m,{span:12},{default:t(()=>[a(u).userId==null?(s(),r(f,{key:0,label:"用户名称",prop:"userName"},{default:t(()=>[l(p,{modelValue:a(u).userName,"onUpdate:modelValue":n[12]||(n[12]=e=>a(u).userName=e),placeholder:"请输入用户名称",maxlength:"30"},null,8,["modelValue"])]),_:1})):h("",!0)]),_:1}),l(m,{span:12},{default:t(()=>[a(u).userId==null?(s(),r(f,{key:0,label:"用户密码",prop:"password"},{default:t(()=>[l(p,{modelValue:a(u).password,"onUpdate:modelValue":n[13]||(n[13]=e=>a(u).password=e),placeholder:"请输入用户密码",type:"password",maxlength:"20","show-password":""},null,8,["modelValue"])]),_:1})):h("",!0)]),_:1})]),_:1}),l(C,null,{default:t(()=>[l(m,{span:12},{default:t(()=>[l(f,{label:"用户性别"},{default:t(()=>[l(q,{modelValue:a(u).sex,"onUpdate:modelValue":n[14]||(n[14]=e=>a(u).sex=e),placeholder:"请选择"},{default:t(()=>[(s(!0),S(T,null,D(a(re),e=>(s(),r(B,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(m,{span:12},{default:t(()=>[l(f,{label:"状态"},{default:t(()=>[l(ze,{modelValue:a(u).status,"onUpdate:modelValue":n[15]||(n[15]=e=>a(u).status=e)},{default:t(()=>[(s(!0),S(T,null,D(a(H),e=>(s(),r(qe,{key:e.value,value:e.value},{default:t(()=>[v(ue(e.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(C,null,{default:t(()=>[l(m,{span:12},{default:t(()=>[l(f,{label:"岗位"},{default:t(()=>[l(q,{modelValue:a(u).postIds,"onUpdate:modelValue":n[16]||(n[16]=e=>a(u).postIds=e),multiple:"",placeholder:"请选择"},{default:t(()=>[(s(!0),S(T,null,D(a(Y),e=>(s(),r(B,{key:e.postId,label:e.postName,value:e.postId,disabled:e.status==1},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(m,{span:12},{default:t(()=>[l(f,{label:"角色"},{default:t(()=>[l(q,{modelValue:a(u).roleIds,"onUpdate:modelValue":n[17]||(n[17]=e=>a(u).roleIds=e),multiple:"",placeholder:"请选择"},{default:t(()=>[(s(!0),S(T,null,D(a(Q),e=>(s(),r(B,{key:e.roleId,label:e.roleName,value:e.roleId,disabled:e.status==1},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(C,null,{default:t(()=>[l(m,{span:24},{default:t(()=>[l(f,{label:"备注"},{default:t(()=>[l(p,{modelValue:a(u).remark,"onUpdate:modelValue":n[18]||(n[18]=e=>a(u).remark=e),type:"textarea",placeholder:"请输入内容"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),l(le,{title:a(b).title,modelValue:a(b).open,"onUpdate:modelValue":n[22]||(n[22]=e=>a(b).open=e),width:"400px","append-to-body":""},{footer:t(()=>[k("div",ml,[l(g,{type:"primary",onClick:Ue},{default:t(()=>[v("确 定")]),_:1}),l(g,{onClick:n[21]||(n[21]=e=>a(b).open=!1)},{default:t(()=>[v("取 消")]),_:1})])]),default:t(()=>[l(Me,{ref:"uploadRef",limit:1,accept:".xlsx, .xls",headers:a(b).headers,action:a(b).url+"?updateSupport="+a(b).updateSupport,disabled:a(b).isUploading,"on-progress":xe,"on-success":Ie,"auto-upload":!1,drag:""},{tip:t(()=>[k("div",rl,[k("div",il,[l(Ee,{modelValue:a(b).updateSupport,"onUpdate:modelValue":n[20]||(n[20]=e=>a(b).updateSupport=e)},null,8,["modelValue"]),v("是否更新已经存在的用户数据 ")]),pl,l(Ke,{type:"primary",underline:!1,style:{"font-size":"12px","vertical-align":"baseline"},onClick:we},{default:t(()=>[v("下载模板")]),_:1})])]),default:t(()=>[l(Oe,{class:"el-icon--upload"},{default:t(()=>[l(Le)]),_:1}),dl]),_:1},8,["headers","action","disabled"])]),_:1},8,["title","modelValue"])])}}});export{gl as default};
