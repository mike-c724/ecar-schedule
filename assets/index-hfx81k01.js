import{F as H}from"./index-DkNaNI8o.js";import{P as S,a1 as J,v as I,r as d,b as Q,g as p,o as s,c as v,f as r,i as n,w as u,e as W,h as $,F as P,C,l as g,m as x,B as X,z as Y,t as ee}from"./index-CBERRbij.js";import{l as le}from"./enterprise-BFje5Ouz.js";import{l as ne}from"./project-BgWX5gs5.js";function ae(c){return S({url:"/product/channels/sub-account/list",method:"get",params:c})}function te(c){return S({url:"/product/channels/sub-account/add-account",method:"post",data:c})}function oe(c){return S({url:"/product/channels/sub-account/edit-account",method:"put",data:c})}function re(c){return S({url:"/product/channels/sub-account/reset-password",method:"put",data:c})}const ue={class:"app-container companies-account"},se={class:"dialog-footer"},ce=Y({name:"Sub-account"}),he=Object.assign(ce,{setup(c){const{proxy:m}=ee(),{order_type:U,common_status:A,evaluation_mode:de,report_templates:ie}=m.useDict("order_type","common_status","evaluation_mode","report_templates"),B=J(),N=I(()=>{const{adminAccount:a}=B;if(a){const{channelEnterpriseId:e}=a;return e}else return null}),w=d(null),T=I(()=>[{type:"input",label:"企业名称",prop:"enterpriseName",placeholder:"请输入企业名称",isCreate:!!N.value},{type:"input",label:"账号昵称",prop:"channelSubAccountName",placeholder:"请输入账号昵称"},{type:"input",label:"子账号",prop:"channelSubAccount",placeholder:"请输入子账号"},{type:"select",label:"状态",prop:"status",placeholder:"请选择状态",options:A.value}]),R=I(()=>[{label:"序号",type:"index",width:50},{prop:"enterpriseName",label:"企业名称",isCreate:!!N.value},{prop:"channelSubAccountName",label:"账号昵称"},{prop:"channelSubAccount",label:"子账号"},{prop:"projectName",label:"项目名称"},{prop:"orderType",label:"订单类型",type:"dict",options:U.value},{prop:"status",label:"状态",type:"dict",options:A.value}]),q=[{label:"编辑",action:"edit",icon:"EditPen"},{label:"重置密码",action:"resetPwd",icon:"Key"}],L=async({row:a,action:e})=>{e==="edit"?j("edit",a):e==="resetPwd"&&m.$prompt('请输入"'+a.channelSubAccountName+'"的新密码',"提示",{confirmButtonText:"确定",cancelButtonText:"取消",closeOnClickModal:!1,inputPattern:/^[A-Za-z0-9]{6,17}$/,inputErrorMessage:"请录入6-17位大小写字母及数字",inputValidator:o=>{if(/<|>|"|'|\||\\/.test(o))return`不能包含非法字符：< > " ' \\ |`}}).then(({value:o})=>{const h={channelSubAccountId:a.channelSubAccountId,channelSubPassword:o,userId:a.subAccountUserId};re(h).then(i=>{m.$modal.msgSuccess("修改成功，新密码是："+o)})}).catch(()=>{})},b=d(!1),f=d("add"),_=d(null),t=d({channelEnterpriseId:null,channelProjectId:null,channelSubAccount:"",channelSubAccountName:"",channelSubPassword:"",status:null}),E=d([]),y=d([]),D=d({channelEnterpriseId:[{required:!0,message:"请选择企业",trigger:"change"}],channelProjectId:[{required:!0,message:"请选择项目",trigger:"change"}],channelSubAccount:[{required:!0,message:"请输入子账号",trigger:"blur"},{pattern:/^[a-zA-Z0-9]{6,15}$/,message:"子账户必须是6-15位字母或数字",trigger:"blur"}],channelSubAccountName:[{required:!0,message:"请输入账号名称",trigger:"blur"}],channelSubPassword:[{required:!0,message:"请输入密码",trigger:"blur"},{pattern:/^[A-Za-z0-9]{6,17}$/,message:"请录入6-17位大小写字母及数字",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]}),j=(a="add",e={})=>{if(f.value=a,b.value=!0,a==="edit"){const{channelEnterpriseId:o}=e;k(o),t.value={...e}}},O=async()=>{const{code:a,data:e}=await le();a===200&&(E.value=e)},k=async a=>{if(console.log("value:",a),t.value.channelProjectId=null,y.value=[],a){const{code:e,data:o}=await ne({channelEnterpriseId:a});e===200&&(y.value=o)}},z=()=>{t.value={channelEnterpriseId:null,channelProjectId:null,channelSubAccount:"",channelSubAccountName:"",channelSubPassword:"",status:null},_.value.resetFields()},M=()=>{b.value=!1},Z=async a=>{if(!a)return;if(!await a.validate(o=>!!o))return!1;m.$modal.loading();try{f.value==="add"?await te(t.value):await oe(t.value),w.value.getList(),b.value=!1;const o=f.value==="add"?"新增子账号":"编辑子账号";m.$modal.msgSuccess(`${o}成功`)}catch(o){console.error("验证或请求失败:",o)}finally{m.$modal.closeLoading()}};return Q(()=>{O()}),(a,e)=>{const o=p("el-option"),h=p("el-select"),i=p("el-form-item"),V=p("el-input"),K=p("el-form"),F=p("el-button"),G=p("el-dialog");return s(),v("div",ue,[r(n(H),{ref_key:"formTableRef",ref:w,"form-config":n(T),"table-columns":n(R),operations:q,api:n(ae),onOperation:L,onAdd:j},null,8,["form-config","table-columns","api"]),r(G,{ref_key:"dialogFormRef",ref:_,title:n(f)==="add"?"新增子账号":"编辑子账号",modelValue:n(b),"onUpdate:modelValue":e[7]||(e[7]=l=>X(b)?b.value=l:null),width:"500","close-on-click-modal":!1,onClose:z},{footer:u(()=>[W("span",se,[r(F,{onClick:M},{default:u(()=>[$("取 消")]),_:1}),r(F,{type:"primary",onClick:e[6]||(e[6]=l=>Z(n(_)))},{default:u(()=>[$("确 定")]),_:1})])]),default:u(()=>[r(K,{ref_key:"dialogFormRef",ref:_,model:n(t),rules:n(D),"label-width":"100px"},{default:u(()=>[r(i,{label:"企业名称",prop:"channelEnterpriseId"},{default:u(()=>[r(h,{modelValue:n(t).channelEnterpriseId,"onUpdate:modelValue":e[0]||(e[0]=l=>n(t).channelEnterpriseId=l),placeholder:"请选择企业名称",onChange:k,clearable:""},{default:u(()=>[(s(!0),v(P,null,C(n(E),l=>(s(),g(o,{key:l.channelEnterpriseId,label:l.enterpriseName,value:l.channelEnterpriseId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(i,{label:"项目名称",prop:"channelProjectId"},{default:u(()=>[r(h,{modelValue:n(t).channelProjectId,"onUpdate:modelValue":e[1]||(e[1]=l=>n(t).channelProjectId=l),placeholder:"请选择项目名称",clearable:""},{default:u(()=>[(s(!0),v(P,null,C(n(y),l=>(s(),g(o,{key:l.channelProjectId,label:l.projectName,value:l.channelProjectId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),r(i,{label:"账号昵称",prop:"channelSubAccountName"},{default:u(()=>[r(V,{modelValue:n(t).channelSubAccountName,"onUpdate:modelValue":e[2]||(e[2]=l=>n(t).channelSubAccountName=l),placeholder:"请输入账号昵称",clearable:""},null,8,["modelValue"])]),_:1}),n(f)==="add"?(s(),g(i,{key:0,label:"子账号",prop:"channelSubAccount"},{default:u(()=>[r(V,{modelValue:n(t).channelSubAccount,"onUpdate:modelValue":e[3]||(e[3]=l=>n(t).channelSubAccount=l),placeholder:"请输入子账号",clearable:""},null,8,["modelValue"])]),_:1})):x("",!0),n(f)==="add"?(s(),g(i,{key:1,label:"密码",prop:"channelSubPassword"},{default:u(()=>[r(V,{modelValue:n(t).channelSubPassword,"onUpdate:modelValue":e[4]||(e[4]=l=>n(t).channelSubPassword=l),placeholder:"请输入密码",clearable:""},null,8,["modelValue"])]),_:1})):x("",!0),r(i,{label:"状态",prop:"status"},{default:u(()=>[r(h,{modelValue:n(t).status,"onUpdate:modelValue":e[5]||(e[5]=l=>n(t).status=l),placeholder:"请选择状态",clearable:""},{default:u(()=>[(s(!0),v(P,null,C(n(A),l=>(s(),g(o,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}}});export{he as default};
