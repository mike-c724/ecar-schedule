import{_ as T,r as v,a0 as U,g as c,R as E,o as u,c as y,e as h,f as o,i as C,B as K,k as W,w as l,h as p,S as q,F as D,C as z,l as w,ah as G,x as H,z as J,t as M}from"./index-Bz8aCySx.js";import{a as Q}from"./detectionCheckbox-47uvDZAE.js";import{p as X,s as Y}from"./popup-uQ3r1aF6.js";const Z={class:"parts"},ee={class:"parts_header"},ae={class:"header_input"},te={class:"parts_body"},se=J({name:"ConfigureParts"}),ne=Object.assign(se,{props:{options:{type:Array,required:!0},loading:{type:Boolean,default:!1}},emits:["success"],setup(b,{emit:L}){const{proxy:n}=M(),k=L,_=b,g=v(null),d=v([]);U(()=>_.options,a=>{d.value=a},{immediate:!0});const i=v(""),x=()=>{if(!i.value.trim()){d.value=_.options;return}d.value=_.options.filter(a=>a.partsName.toLowerCase().includes(i.value.toLowerCase()))},B=()=>{i.value="",d.value=_.options},R=async a=>{n.$modal.loading("加载配置数据...");try{const e=await $(a);e?g.value.handleOpen(e):g.value.handleOpen(a)}catch(e){console.error("获取零部件配置失败:",e)}finally{n.$modal.closeLoading()}},$=async a=>{const{evaluationPlanId:e}=a;if(!e)return null;try{const{code:t,data:f}=await Q(a);if(t===200)return f}catch(t){throw console.error("获取零部件配置详情失败:",t),t}return null},s=v({}),S=async a=>{const{evaluationPlanId:e}=a;if(s.value.evaluationPlanId&&!e){const t={...a,shootingConfiguration:s.value.shootingConfiguration,enablesRestrictedUndetectable:s.value.enablesRestrictedUndetectable,partsAssessmentList:s.value.partsAssessmentList||[]};I(t);return}if(!s.value.evaluationPlanId&&!e){n.$message.warning("请先配置该零部件");return}if(!s.value.evaluationPlanId&&e){try{const t=await $(a);t?(s.value={...t},n.$message.success("复制成功，可粘贴到其他未配置的零部件")):n.$message.warning("无法获取配置数据")}catch(t){n.$message.error("复制失败："+t.message)}return}if(s.value.evaluationPlanId===e){n.$message.warning("已清除复制的配置数据"),s.value={};return}s.value.evaluationPlanId&&e&&s.value.evaluationPlanId!==e&&n.$confirm("该零部件已有配置，是否覆盖？","配置覆盖确认",{confirmButtonText:"确定覆盖",cancelButtonText:"取消",type:"warning"}).then(()=>{const t={...a,partsAssessmentList:s.value.partsAssessmentList||[]};I(t)}).catch(()=>{n.$message({type:"info",message:"已取消覆盖操作"})})},I=async a=>{n.$modal.loading("保存中...");try{await Y(a),s.value={},n.$modal.msgSuccess("复制配置成功"),k("success")}catch(e){console.error("保存数据失败:",e)}finally{n.$modal.closeLoading()}},V=()=>{k("success")};return(a,e)=>{const t=c("el-input"),f=c("el-button"),A=c("WarningFilled"),N=c("el-icon"),m=c("el-text"),P=c("el-col"),F=c("el-row"),j=E("loading");return u(),y(D,null,[h("div",Z,[h("div",ee,[h("div",ae,[o(t,{"prefix-icon":"Search",class:"search_input",modelValue:C(i),"onUpdate:modelValue":e[0]||(e[0]=r=>K(i)?i.value=r:null),placeholder:"请输入零部件名称",clearable:"",onKeydown:W(x,["enter"])},null,8,["modelValue"]),o(f,{type:"primary",onClick:x},{default:l(()=>[p("搜索")]),_:1}),o(f,{onClick:B},{default:l(()=>[p("重置")]),_:1})])]),q((u(),y("div",te,[(u(!0),y(D,null,z(C(d),r=>(u(),w(F,{gutter:20,key:r.value},{default:l(()=>[o(P,{span:16},{default:l(()=>[o(m,{class:"parts_body_icon"},{default:l(()=>[o(N,null,{default:l(()=>[r.evaluationPlanId?(u(),w(C(G),{key:0,color:"#67c23a"})):(u(),w(A,{key:1,color:"#e6a23c"}))]),_:2},1024)]),_:2},1024),o(m,null,{default:l(()=>[p(H(r.partsName),1)]),_:2},1024)]),_:2},1024),o(P,{span:8,class:"parts_body_edit"},{default:l(()=>[o(m,{type:"primary",class:"mx-1",onClick:O=>S(r)},{default:l(()=>[p("复制")]),_:2},1032,["onClick"]),o(m,{type:"primary",class:"mx-1",onClick:O=>R(r)},{default:l(()=>[p("配置")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))])),[[j,b.loading]])]),o(X,{ref_key:"popupRef",ref:g,onSuccess:V},null,512)],64)}}}),ce=T(ne,[["__scopeId","data-v-a7e361ba"]]);export{ce as default};
