import{b1 as de,b2 as ue,b3 as ie,_ as pe,a as he,u as ve,r as y,b as fe,g as p,o as l,c,f as n,w as r,e as f,h as B,F as _,C as g,i as z,l as b,x as j,m as k,n as V,t as me,b4 as _e}from"./index-CBERRbij.js";import ge from"./uploadVehicleDamageZip-B7Hk_14t.js";import{i as ye,H as Ie}from"./useOrderInfo-NxrpNegM.js";const Pe=async()=>{const I=await de(ye.value);return Ie.value=I.data,I.data},be=async I=>{try{const{code:v}=await ue(I);return v===200}catch{}return!1},Z=async I=>(await ie({type:I})).data,Le={class:"vehicle-damage-info-template"},ke={class:"header"},Ve={class:"upload_btn_group"},we={class:"cardBox"},Ue={key:0,class:"item-damage-parts"},Ce={key:0,class:"tag-container showcase"},xe={class:"tag-label"},De={class:"content-damage"},Re={class:"option-content"},Ae=["onClick"],Se={key:0,class:"tag-container"},$e={class:"tag-label"},Te={class:"parts-list"},Be={style:{"text-align":"right","margin-top":"32px"}},Me={__name:"recheckInfoTemplate",setup(I){const{proxy:v}=me(),{damage_advice:H,damage_position:K}=v.useDict("damage_advice","damage_position"),q=he(),G=ve(),u=y({frontPhoto:{photoId:"",photoUrl:""},backPhoto:{photoId:"",photoUrl:""},platePhoto:{photoId:"",photoUrl:""},orderId:"",partsInfoList:[],othersDescription:"",unselectedPhotoList:[]}),w=y(!1),U=y([]),C=y(0),x=y(!1),M=y([]),J={label:"name",value:"id",children:"children",checkStrictly:!1},D=y([]),R=y([]);function A(o){!o||!o.photoId||u.value.unselectedPhotoList.some(t=>t.photoId===o.photoId)||u.value.unselectedPhotoList.unshift(o)}const Q=async()=>{try{const o=await _e();M.value=o.data||[]}catch(o){console.error("Failed to fetch damage tree list:",o)}},W=o=>{o.forEach(t=>{A({photoId:t.orderPhotoId,photoUrl:t.photoOriginal})})},X=()=>{u.value.partsInfoList.forEach(o=>{(o.resurveyPhotoIdList||[]).forEach((t,s)=>{let i="";if(o.resurveyPhotoList&&Array.isArray(o.resurveyPhotoList)){const d=o.resurveyPhotoList.find(m=>m.photoId===t);d&&(i=d.photoUrl)}A({photoId:t,photoUrl:i})})})},N=({currentKey:o="",currentIdx:t=-1,currentIds:s=[]})=>{const i=[u.value.frontPhoto.photoId,u.value.backPhoto.photoId,u.value.platePhoto.photoId].filter(Boolean),d=u.value.partsInfoList.flatMap((h,S)=>t!==-1&&S===t?[]:h.resurveyPhotoIdList||[]).filter(Boolean),m=Array.isArray(s)?s:s?[s]:[];return u.value.unselectedPhotoList.filter(h=>!i.includes(h.photoId)&&!d.includes(h.photoId)||m.includes(h.photoId))},Y=(o,t)=>{const s=(t||[]).map(i=>u.value.unselectedPhotoList.find(d=>d.photoId===i)).filter(Boolean);o.resurveyPhotoList=s},ee=(o,t)=>{o.resurveyPhotoList=o.resurveyPhotoList.filter(s=>s.photoId!==t.photoId),o.resurveyPhotoIdList=o.resurveyPhotoIdList.filter(s=>s!==t.photoId),A({photoId:t.photoId,photoUrl:t.photoUrl})};function oe(o,t){U.value=(t||[]).map(s=>s.photoUrl),C.value=(t||[]).findIndex(s=>s.photoId===o.photoId),w.value=!0}function te(){w.value=!1,U.value=[],C.value=0}const E=async()=>{v.$modal.loading("正在保存...");const o=await be(u.value);return o&&v.$message.success("保存成功"),v.$modal.closeLoading(),o},ae=()=>{E().then(o=>{o&&q.push({path:`/evaluationManagement/conclusion/view/${G.params.id}`})})},le=async()=>{try{const o=await Z("0"),t=await Z("1");D.value=o||[],R.value=t||[]}catch{}},F=(o,t,s)=>{if(s==="nuclear"){const i=D.value.find(d=>d.id===t)||{};o.verifyResult.name=i.name||""}else if(s==="survey"){const i=R.value.find(d=>d.id===t)||{};o.inspectionResult.name=i.name||""}};return fe(async()=>{v.$modal.loading("正在加载...");try{await Q(),await le(),u.value=await Pe(),X()}catch{}finally{v.$modal.closeLoading()}}),(o,t)=>{const s=p("el-button"),i=p("el-input"),d=p("el-col"),m=p("el-option"),h=p("el-select"),S=p("el-row"),$=p("el-image"),O=p("el-tag"),se=p("el-cascader"),ne=p("el-card"),re=p("el-form"),ce=p("el-image-viewer");return l(),c("div",Le,[n(re,{model:u.value,"label-width":"auto"},{default:r(()=>[f("div",ke,[f("div",Ve,[n(s,{icon:"Plus",type:"primary",onClick:t[0]||(t[0]=a=>x.value=!0)},{default:r(()=>[B(" 上传复勘图片 ")]),_:1})])]),f("div",we,[u.value.partsInfoList.length?(l(),c("div",Ue,[(l(!0),c(_,null,g(u.value.partsInfoList,(a,T)=>(l(),c("div",{class:"custom-card",key:T},[n(ne,{style:{width:"100%"}},{header:r(()=>[n(S,{class:"card-header",gutter:20},{default:r(()=>[n(d,{span:6},{default:r(()=>[n(i,{modelValue:a.partsName,"onUpdate:modelValue":e=>a.partsName=e,placeholder:"请输入备件名称",disabled:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),n(d,{span:6},{default:r(()=>[n(h,{modelValue:a.damageSuggestion,"onUpdate:modelValue":e=>a.damageSuggestion=e,placeholder:"请选择伤损建议",disabled:""},{default:r(()=>[(l(!0),c(_,null,g(z(H),e=>(l(),b(m,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),n(d,{span:6},{default:r(()=>[n(h,{modelValue:a.verifyResult.id,"onUpdate:modelValue":e=>a.verifyResult.id=e,onChange:e=>F(a,e,"nuclear"),placeholder:"请选择核损结果"},{default:r(()=>[(l(!0),c(_,null,g(D.value,e=>(l(),b(m,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1024),n(d,{span:6,style:{"text-align":"right"}},{default:r(()=>[n(h,{modelValue:a.inspectionResult.id,"onUpdate:modelValue":e=>a.inspectionResult.id=e,onChange:e=>F(a,e,"survey"),placeholder:"请选择勘验结果"},{default:r(()=>[(l(!0),c(_,null,g(R.value,e=>(l(),b(m,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1024)]),_:2},1024)]),default:r(()=>[a.photoList&&a.photoList.length?(l(),c("div",Ce,[(l(!0),c(_,null,g(a.photoList,e=>(l(),b(O,{key:e.photoId,class:"custom-tag",size:"large","disable-transitions":!1},{default:r(()=>[n($,{class:"tag-image",src:e.photoUrl,fit:"contain"},null,8,["src"]),f("span",xe,j(e.photoId),1)]),_:2},1024))),128))])):k("",!0),f("div",De,[n(h,{modelValue:a.resurveyPhotoIdList,"onUpdate:modelValue":e=>a.resurveyPhotoIdList=e,onChange:e=>Y(a,e),multiple:"",placeholder:"请选择损伤类型图片",style:{width:"100%"},class:"custom-select","popper-class":"custom-select-popper"},{tag:r(()=>[a.resurveyPhotoList&&a.resurveyPhotoList.length?(l(),c("div",Se,[(l(!0),c(_,null,g(a.resurveyPhotoList,e=>(l(),b(O,{key:e.photoId,class:"custom-tag",closable:"",size:"large","disable-transitions":!1,onClose:L=>ee(a,e)},{default:r(()=>[n($,{class:"tag-image",src:e.photoUrl,fit:"contain"},null,8,["src"]),f("span",$e,j(e.photoId),1)]),_:2},1032,["onClose"]))),128))])):k("",!0)]),default:r(()=>[(l(!0),c(_,null,g(N({currentIdx:T,currentIds:a.resurveyPhotoIdList}),e=>(l(),b(m,{key:e.photoId,label:e.photoId,value:e.photoId,class:"custom-option"},{default:r(()=>[f("div",Re,[n($,{class:"option-image",src:e.photoUrl,fit:"contain"},null,8,["src"]),f("span",{class:"option-label",onClick:V(L=>oe(e,N({currentIdx:T,currentIds:a.resurveyPhotoIdList})),["stop"])}," 查看大图 ",8,Ae)])]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),f("div",Te,[(l(!0),c(_,null,g(a.lossInfoList,(e,L)=>(l(),c("div",{class:"row-parts",key:L,style:{display:"flex","align-items":"center",gap:"12px"}},[n(se,{modelValue:a.lossInfoList[L].damageId,"onUpdate:modelValue":P=>a.lossInfoList[L].damageId=P,options:M.value,props:J,filterable:"",clearable:"",style:{width:"240px"},placeholder:"请选择备件材质",disabled:""},null,8,["modelValue","onUpdate:modelValue","options"]),n(h,{modelValue:e.damagePart,"onUpdate:modelValue":P=>e.damagePart=P,placeholder:"请选择伤损部位",style:{width:"240px"},disabled:""},{default:r(()=>[(l(!0),c(_,null,g(z(K),P=>(l(),b(m,{key:P.value,label:P.label,value:P.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]))),128))])])]),_:2},1024)]))),128))])):k("",!0)])]),_:1},8,["model"]),w.value?(l(),c("div",{key:0,class:"image-viewer-mask",onMousedown:t[1]||(t[1]=V(()=>{},["stop"])),onMouseup:t[2]||(t[2]=V(()=>{},["stop"])),onClick:t[3]||(t[3]=V(()=>{},["stop"]))},[n(ce,{"url-list":U.value,"initial-index":C.value,onClose:te},null,8,["url-list","initial-index"])],32)):k("",!0),n(ge,{visibleDamageAssessment:x.value,"onUpdate:visibleDamageAssessment":t[4]||(t[4]=a=>x.value=a),onSuccess:W,"upload-type":"3",title:"上传复勘图片ZIP包",description:"照片列表"},null,8,["visibleDamageAssessment"]),f("div",Be,[n(s,{type:"primary",onClick:ae},{default:r(()=>[B("查看结论")]),_:1}),n(s,{type:"primary",onClick:E},{default:r(()=>[B("保存")]),_:1})])])}}},Ne=pe(Me,[["__scopeId","data-v-32188aac"]]),ze=Object.freeze(Object.defineProperty({__proto__:null,default:Ne},Symbol.toStringTag,{value:"Module"}));export{ze as a,Ne as r,be as s};
