import{_ as z,r as i,A as G,a0 as P,g as d,o as m,l as g,w as c,f as s,h as x,c as V,F as y,C as A,D as C,am as U}from"./index-Bz8aCySx.js";const H={__name:"createOrder",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","confirm"],setup(J,{expose:E,emit:O}){const L=O,f=i(!1),_=i(!1),p=i(null),S=i([]),v=i([]),b=i([]),h=i([]),I=i([]),a=G({detectionItem:"",detectionScheme:"",subAccount:[],detectionLocation:""}),N={detectionItem:[{required:!0,message:"请选择项目",trigger:"change"}],detectionScheme:[{required:!0,message:"请选择检测方案",trigger:"change"}],subAccount:[{required:!0,message:"请选择子账号",trigger:"change",validator:(l,e,n)=>{!e||e.length===0?n(new Error("请选择子账号")):n()}}],detectionLocation:[{required:!0,message:"请输入检测地点",trigger:"blur"},{max:50,message:"检测地点不能超过50字",trigger:"blur"}]},q=async l=>{l!=null&&l.data&&B(l.data),F(),await C(),f.value=!0},B=l=>{if(!Array.isArray(l))return;console.log("data",l),S.value=l.map(o=>({label:o.projectName,value:o.channelProjectId}));const e=[];l.forEach(o=>{var u;(u=o.detectionProtocolsList)!=null&&u.length&&(console.log("project.detectionProtocolsList",o.detectionProtocolsList),o.detectionProtocolsList.forEach(r=>{e.push({label:r.planName,value:r.detectionProtocolsId,key:`${o.channelProjectId}-${r.detectionProtocolsId}`,projectId:o.channelProjectId,version:o.version||null})}))}),h.value=e,v.value=e,console.log("schemesList",e);const n=[];l.forEach(o=>{var u;(u=o.channelSubAccountList)!=null&&u.length&&o.channelSubAccountList.forEach(r=>{n.push({label:r.channelSubAccountName,value:r.subAccountUserId,key:`${o.channelProjectId}-${r.subAccountUserId}`,projectId:o.channelProjectId})})}),I.value=n,b.value=n};P(()=>a.detectionItem,l=>{l?(v.value=h.value.filter(e=>e.projectId===l),b.value=I.value.filter(e=>e.projectId===l),a.detectionScheme="",a.subAccount=[]):(v.value=h.value,b.value=I.value)}),P(f,l=>{L("update:modelValue",l)});const F=()=>{var l;(l=p.value)==null||l.clearValidate(),Object.assign(a,{detectionItem:"",detectionScheme:"",subAccount:[],detectionLocation:""}),C(()=>{var e;(e=p.value)==null||e.clearValidate()})},k=()=>{f.value=!1},$=async()=>{var l;try{await((l=p.value)==null?void 0:l.validate()),_.value=!0;const e=h.value.find(o=>o.value===a.detectionScheme),n={channelProjectId:a.detectionItem,detectionLocation:a.detectionLocation,detectionProtocolsId:a.detectionScheme,subAccountUserIds:a.subAccount,version:(e==null?void 0:e.version)||null};L("confirm",n),U.success("创建订单成功"),f.value=!1}catch{U.warning("请填写完整信息")}finally{_.value=!1}};return E({openDialog:q}),(l,e)=>{const n=d("el-option"),o=d("el-select"),u=d("el-form-item"),r=d("el-input"),R=d("el-form"),w=d("el-button"),M=d("el-dialog");return m(),g(M,{modelValue:f.value,"onUpdate:modelValue":e[4]||(e[4]=t=>f.value=t),title:"创建订单",width:"700px","close-on-click-modal":!1,onClose:k},{footer:c(()=>[s(w,{onClick:k},{default:c(()=>[x("取消")]),_:1}),s(w,{type:"primary",loading:_.value,onClick:$},{default:c(()=>[x("确定")]),_:1},8,["loading"])]),default:c(()=>[s(R,{ref_key:"formRef",ref:p,model:a,rules:N,"label-width":"100px"},{default:c(()=>[s(u,{label:"项目",prop:"detectionItem"},{default:c(()=>[s(o,{modelValue:a.detectionItem,"onUpdate:modelValue":e[0]||(e[0]=t=>a.detectionItem=t),placeholder:"请选择项目",clearable:"",style:{width:"100%"}},{default:c(()=>[(m(!0),V(y,null,A(S.value,t=>(m(),g(n,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(u,{label:"检测方案",prop:"detectionScheme"},{default:c(()=>[s(o,{modelValue:a.detectionScheme,"onUpdate:modelValue":e[1]||(e[1]=t=>a.detectionScheme=t),placeholder:"请选择检测方案",clearable:"",style:{width:"100%"}},{default:c(()=>[(m(!0),V(y,null,A(v.value,t=>(m(),g(n,{key:t.key,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(u,{label:"子账号",prop:"subAccount"},{default:c(()=>[s(o,{modelValue:a.subAccount,"onUpdate:modelValue":e[2]||(e[2]=t=>a.subAccount=t),placeholder:"请选择子账号",multiple:"",clearable:"","collapse-tags":"","collapse-tags-tooltip":"",style:{width:"100%"}},{default:c(()=>[(m(!0),V(y,null,A(b.value,t=>(m(),g(n,{key:t.key,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(u,{label:"检测地点",prop:"detectionLocation"},{default:c(()=>[s(r,{modelValue:a.detectionLocation,"onUpdate:modelValue":e[3]||(e[3]=t=>a.detectionLocation=t),placeholder:"请输入检测地点",maxlength:"50","show-word-limit":"",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}},Q=z(H,[["__scopeId","data-v-58a63f71"]]);export{Q as default};
