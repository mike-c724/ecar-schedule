import{F as P}from"./index-DkNaNI8o.js";import{t as U,C as F,d as E}from"./claimAssessment-pSrIfFfm.js";import{r as c,v as _,g as V,o as w,c as O,f as l,w as n,h as i,aI as B,F as j,m as q,i as r,B as v,z,t as G}from"./index-CBERRbij.js";import{e as k}from"./jsencrypt-cBOclhC6.js";import H from"./buildOrder-aB2qTsXJ.js";import J from"./batchBuild-CXXTgqWU.js";import K from"./offlineAssessmentCreation-CH_wC5sg.js";import"./jsencrypt.min-BU9v9zQp.js";const Q={class:"app-container"},W=z({name:"TemporaryOrderCreation"}),ne=Object.assign(W,{setup(X){const g=c(),{proxy:b}=G(),p=c(!1),T=_(()=>[{type:"daterange",label:"提交时间",prop:"time",placeholder:"请选择提交时间"},{type:"select",label:"检测类型",prop:"orderType",placeholder:"请选择检测类型",options:[{label:"保前检测",value:"3"},{label:"定损检测",value:"4"}]},{type:"select",label:"检测状态",prop:"queryStatus",placeholder:"请选择检测状态",options:[{label:"检测中",value:"0"},{label:"检测完成",value:"1"},{label:"已驳回",value:"2"}]}]),L=_(()=>[{label:"序号",type:"index"},{prop:"orderNo",label:"订单编号"},{prop:"vehicleLicense",label:"行驶证",slot:"vehicleLicense"},{prop:"dashboard",label:"仪表盘",slot:"dashboard"},{prop:"orderType",label:"检测类型",formatter:(t,e)=>({3:"保前检测",4:"定损检测"})[e.orderType]||"未知类型"},{label:"创建时间",formatter:(t,e)=>e.createTime},{label:"检测状态",formatter:(t,e)=>({0:"检测中",1:"检测完成",2:"已驳回"})[e.orderStatus]||"未知状态"},{label:"操作",slot:"operations",width:240,align:"center",fixed:"right"}]),m=c(null),u=c(!1),f=c(!1),A=[{prop:"time",startTime:"submitStartTime",endTime:"submitEndTime"}],R=()=>{p.value=!0},y=(t,e)=>{var s,o;if(e==="vehicleLicense"){const a=(((s=t.orderBase)==null?void 0:s.orderBasePhoto)||[]).find(d=>d.photoName=="drivingLicensePhotoA"&&d.photoDict=="base_info_id");return(a==null?void 0:a.photoOriginal)||""}else if(e==="dashboard"){const a=(((o=t.orderBase)==null?void 0:o.orderBasePhoto)||[]).find(d=>d.photoName=="dashboard"&&d.photoDict=="base_info_id");return(a==null?void 0:a.photoOriginal)||""}return""},h=({action:t,row:e})=>{const s={downloadReport:()=>$(e),viewDetails:()=>x(e)};s[t]&&s[t]()},$=t=>{b.$modal.loading("报告下载中，请稍后···"),E(t.orderId).then(async e=>{const o=await(await fetch(e.data)).blob(),a=document.createElement("a");a.href=window.URL.createObjectURL(o),a.target="_blank",a.download=`${t.planName}-${t.vin}.pdf`,document.body.appendChild(a),a.click(),document.body.removeChild(a)}).finally(()=>{b.$modal.closeLoading()})},x=t=>{if(console.log("在线查看",t),t.templateType==1){const e=k(t.orderId);window.open(`${window.location.origin}/evaluationManagement/record/view/${e}`)}else if(t.templateType==2){const e=k(t.orderId);window.open(`${window.location.origin}/evaluationManagement/chassisReport/view/${e}`)}else b.$message.error("无此类型报告")},S=()=>{g.value.open()},I=()=>{console.log("定损建单"),u.value=!0},M=()=>{console.log("批量建单"),f.value=!0},D=()=>{m.value.getList()},N=()=>{m.value.getList()},C=()=>{m.value.getList()};return(t,e)=>{const s=V("el-button");return w(),O("div",Q,[l(P,{ref_key:"formTableRef",ref:m,"form-config":r(T),"table-columns":r(L),api:r(U),showAdd:!1,"daterange-map-list":A,onOperation:h},{"form-operations-suffix":n(()=>[l(s,{type:"primary",onClick:S},{default:n(()=>[i("保前建单")]),_:1}),l(s,{type:"primary",onClick:M},{default:n(()=>[i("批量建单(保前)")]),_:1}),l(s,{type:"primary",onClick:I},{default:n(()=>[i("线上定损建单")]),_:1}),l(s,{type:"primary",onClick:R},{default:n(()=>[i("线下定损建单")]),_:1})]),"table-vehicleLicense":n(({row:o})=>[l(B,{src:y(o,"vehicleLicense"),width:50,fit:"contain",height:50},null,8,["src"])]),"table-dashboard":n(({row:o})=>[l(B,{src:y(o,"dashboard"),width:50,fit:"contain",height:50},null,8,["src"])]),"table-operations":n(({row:o})=>[o.orderStatus==1?(w(),O(j,{key:0},[l(s,{type:"primary",text:"",onClick:a=>h({row:o,action:"downloadReport"})},{default:n(()=>[i(" 下载报告 ")]),_:2},1032,["onClick"]),l(s,{type:"primary",text:"",onClick:a=>h({row:o,action:"viewDetails"})},{default:n(()=>[i(" 在线查看 ")]),_:2},1032,["onClick"])],64)):q("",!0)]),_:1},8,["form-config","table-columns","api"]),l(J,{visiblebatchBuild:r(f),"onUpdate:visiblebatchBuild":e[0]||(e[0]=o=>v(f)?f.value=o:null),onSuccess:N},null,8,["visiblebatchBuild"]),l(H,{ref_key:"dialogRef",ref:g,onCreate:C},null,512),l(r(F),{visibleClaimAssessment:r(u),"onUpdate:visibleClaimAssessment":e[1]||(e[1]=o=>v(u)?u.value=o:null),onSuccess:D},null,8,["visibleClaimAssessment"]),l(K,{visibleOfflineAssessment:r(p),"onUpdate:visibleOfflineAssessment":e[2]||(e[2]=o=>v(p)?p.value=o:null),onCreate:C},null,8,["visibleOfflineAssessment"])])}}});export{ne as default};
