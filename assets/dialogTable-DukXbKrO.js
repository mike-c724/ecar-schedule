import{_ as ce,r as g,A as ie,b as pe,g as f,o as S,c as he,f as d,w as c,l as F,i as D,bg as E,m as C,D as V}from"./index-Bz8aCySx.js";const ve={class:"photo-table-container"},Oe={__name:"dialogTable",props:{photoOptions:{type:Array,default:()=>[]},modelValue:{type:Array,default:()=>[]}},emits:["update:modelValue","validate"],setup($,{expose:N,emit:T}){const h=$,m=T,a=g([]),i=g(null),u=ie({shootOrder:{},reportOrder:{}}),v=g([]),x={background:"#f5f7fa",color:"#606266",fontWeight:"bold"},B={borderBottom:"none"},A=()=>{a.value=h.photoOptions.map(e=>{const t=h.modelValue.includes(e.value),r=v.value.find(o=>o.value===e.value);return{...e,selected:t,shootOrder:(r==null?void 0:r.shootOrder)||"",reportOrder:(r==null?void 0:r.reportOrder)||""}}),V(()=>{a.value.forEach(e=>{var t,r;e.selected?(t=i.value)==null||t.toggleRowSelection(e,!0):(r=i.value)==null||r.toggleRowSelection(e,!1)})})},K=e=>{M(e),I(e),U(e),O()},M=e=>{a.value.forEach(t=>{const r=e.some(o=>o.value===t.value||o.value.toString()===t.value.toString());t.selected!==r&&(t.selected=r)})},I=e=>{v.value=e.map(t=>({value:t.value,shootOrder:t.shootOrder||"",reportOrder:t.reportOrder||""}))},U=e=>{const t=e.map(r=>r.value);m("update:modelValue",t)},y=(e,t,r)=>{if(j(e)){_(t,r);return}const o=q(e);P(o)?W(t,r,o):_(t,r),b(r)},j=e=>e===""||e===null,_=(e,t)=>{e[t]=""},q=e=>parseInt(e,10),P=e=>!isNaN(e)&&e>0&&e<=999,W=(e,t,r)=>{e[t]=r},b=e=>{z(e);const t=G(e);H(e,t),O()},z=e=>{u[e]={}},G=e=>{const t=R(e),r={};return t.forEach(o=>{r[o.order]=(r[o.order]||0)+1}),r},R=e=>a.value.filter(t=>t.selected&&t[e]!=="").map(t=>({value:t.value,order:t[e]})),H=(e,t)=>{R(e).forEach(o=>{t[o.order]>1&&(u[e][o.value]=!0)})},w=(e,t)=>u[t][e.value]===!0,k=(e,t)=>{console.log(`${t}: ${e.label}, value=${e.value}, shootOrder=${e.shootOrder}(${typeof e.shootOrder}), reportOrder=${e.reportOrder}(${typeof e.reportOrder})`)},O=()=>{const e=J(),t=L(),r=e&&t;return Q(r),r},J=()=>a.value.filter(t=>t.selected).every(t=>t.shootOrder!==""&&t.reportOrder!==""),L=()=>{const e=Object.keys(u.shootOrder).length>0,t=Object.keys(u.reportOrder).length>0;return!e&&!t},Q=e=>{m("validate",{valid:e,message:e?"":"请检查标准照片的拍摄顺序和报告顺序（必须为1-999之间的整数且不能重复）"})},X=()=>Y(),Y=()=>a.value.filter(e=>e.selected).map(e=>Z(e)),Z=e=>({photoKey:e.value.toString(),shotOrder:e.shootOrder,reportOrder:e.reportOrder}),ee=()=>{v.value=[],u.shootOrder={},u.reportOrder={},a.value=h.photoOptions.map(e=>({...e,selected:!1,shootOrder:"",reportOrder:""})),V(()=>{a.value.forEach(e=>{var t;(t=i.value)==null||t.toggleRowSelection(e,!1)})})};pe(()=>{A()});const te=e=>{if(!Array.isArray(e)||e.length===0)return;const t=re(e);oe(e),V(()=>ne(t))},re=e=>e.map(r=>r.photoKey.toString()),oe=(e,t)=>{a.value=h.photoOptions.map(r=>{const o=r.value.toString(),n=le(e,r,o);if(n){const{parsedShotOrder:p,parsedReportOrder:l}=ae(n);return{...r,selected:!0,shootOrder:p,reportOrder:l}}return{...r,selected:!1,shootOrder:"",reportOrder:""}})},le=(e,t,r)=>e.find(o=>o.photoKey===t.value||o.photoKey===r||o.photoKey.toString()===r),ae=e=>{const t=e.shotOrder,r=e.reportOrder;let o="";t!=null&&t!==""&&(o=Number(t),isNaN(o)&&(o=t));let n="";return r!=null&&r!==""&&(n=Number(r),isNaN(n)&&(n=r)),{parsedShotOrder:o,parsedReportOrder:n}},ne=e=>{var t;(t=i.value)==null||t.clearSelection(),se(e),de(e),O(),ue(e)},se=e=>{a.value.forEach(t=>{var n;const r=t.value.toString();if(e.includes(r)){t.selected=!0;try{(n=i.value)==null||n.toggleRowSelection(t,!0)}catch(p){console.error(`选中行失败: ${t.label}`,p)}}})},de=e=>{v.value=a.value.filter(t=>e.includes(t.value.toString())).map(t=>({value:t.value,shootOrder:t.shootOrder,reportOrder:t.reportOrder}))},ue=e=>{const t=a.value.filter(r=>e.includes(r.value.toString())).map(r=>r.value);m("update:modelValue",t)};return N({validate:O,getTableData:X,resetTable:ee,initTableWithData:te}),(e,t)=>{const r=f("el-table-column"),o=f("el-icon"),n=f("el-input"),p=f("el-table");return S(),he("div",ve,[d(p,{ref_key:"photoTableRef",ref:i,data:a.value,style:{width:"100%"},border:!1,"show-header":!0,"header-cell-style":x,"cell-style":B,onSelectionChange:K,"max-height":400,"row-key":"value"},{default:c(()=>[d(r,{type:"selection",width:"55",align:"center",selectable:l=>!0,"reserve-selection":!0}),d(r,{prop:"label",label:"照片名称",align:"center"}),d(r,{label:"拍摄顺序",align:"center",width:"120"},{default:c(l=>[d(n,{modelValue:l.row.shootOrder,"onUpdate:modelValue":s=>l.row.shootOrder=s,modelModifiers:{number:!0},placeholder:"请输入",disabled:!l.row.selected,maxlength:"3",onInput:s=>y(s,l.row,"shootOrder"),onBlur:t[0]||(t[0]=s=>b("shootOrder")),onFocus:s=>k(l.row,"拍摄顺序获得焦点")},{suffix:c(()=>[l.row.selected&&w(l.row,"shootOrder")?(S(),F(o,{key:0,color:"#F56C6C"},{default:c(()=>[d(D(E))]),_:1})):C("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","onInput","onFocus"])]),_:1}),d(r,{label:"报告顺序",align:"center",width:"120"},{default:c(l=>[d(n,{modelValue:l.row.reportOrder,"onUpdate:modelValue":s=>l.row.reportOrder=s,modelModifiers:{number:!0},placeholder:"请输入",disabled:!l.row.selected,maxlength:"3",onInput:s=>y(s,l.row,"reportOrder"),onBlur:t[1]||(t[1]=s=>b("reportOrder")),onFocus:s=>k(l.row,"报告顺序获得焦点")},{suffix:c(()=>[l.row.selected&&w(l.row,"reportOrder")?(S(),F(o,{key:0,color:"#F56C6C"},{default:c(()=>[d(D(E))]),_:1})):C("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","onInput","onFocus"])]),_:1})]),_:1},8,["data"])])}}},me=ce(Oe,[["__scopeId","data-v-395f7679"]]);export{me as default};
