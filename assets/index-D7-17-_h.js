import{F as J}from"./index-DkNaNI8o.js";import{a as K,g as Q,b as W,e as X}from"./project-BgWX5gs5.js";import{c as Y}from"./index-C2-I7XPk.js";import{l as Z}from"./enterprise-BFje5Ouz.js";import{r as c,v as E,b as ee,g as p,o as d,c as v,f as a,w as n,i as o,e as le,h as F,F as b,C as _,l as y,B as oe,z as te,t as ae}from"./index-CBERRbij.js";const re={class:"app-container project"},ne={class:"dialog-footer"},se=te({name:"Project"}),fe=Object.assign(se,{setup(de){const{proxy:f}=ae(),{order_type:h,common_status:I,evaluation_mode:D,report_templates:M}=f.useDict("order_type","common_status","evaluation_mode","report_templates"),C=c(null),q=E(()=>[{type:"input",label:"企业名称",prop:"enterpriseName",placeholder:"请输入企业名称"},{type:"input",label:"项目名称",prop:"projectName",placeholder:"请输入项目名称"},{type:"select",label:"状态",prop:"orderType",placeholder:"请选择订单类型",options:h.value}]),x=E(()=>[{label:"序号",type:"index"},{prop:"enterpriseName",label:"企业名称"},{prop:"projectName",label:"项目名称"},{prop:"orderType",label:"订单类型",type:"dict",options:h.value},{prop:"reportTemplates",label:"报告模板",type:"dict",options:M.value},{prop:"status",label:"状态",type:"dict",options:I.value}]),L=[{label:"编辑",action:"edit"}],U=({row:s,action:l})=>{l==="edit"&&$(s)},$=async s=>{f.$modal.loading();try{const{code:l,data:t}=await Q(s);l===200&&N("edit",t)}catch(l){console.error("获取详情失败:",l)}finally{f.$modal.closeLoading()}},g=c(!1),V=c("add"),P=c(null),r=c({channelEnterpriseId:null,detectionProtocolsIds:[],maintenanceSwitch:"1",obdSwitch:"1",projectName:null,reportTemplates:null,status:null,orderType:null,evaluationMode:null}),T=c([]),w=c([]),R=c({channelEnterpriseId:[{required:!0,message:"请选择企业名称",trigger:"change"}],projectName:[{required:!0,message:"请输入项目名称",trigger:"blur"}],orderType:[{required:!0,message:"请选择订单类型",trigger:"change"}],reportTemplates:[{required:!0,message:"请输入报告模板",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"change"}],evaluationMode:[{required:!0,message:"请选择评估模式",trigger:"change"}],detectionProtocolsIds:[{required:!0,message:"请选择检查方案",trigger:"change"}]}),B=async()=>{const{code:s,data:l}=await Z();s===200&&(w.value=l)},N=(s="add",l={})=>{if(V.value=s,g.value=!0,s==="edit"){const t={...l};t.detectionProtocolsId&&(t.detectionProtocolsIds=[t.detectionProtocolsId]),r.value=t,j("edit")}},S=()=>{r.value={channelEnterpriseId:null,detectionProtocolsIds:[],maintenanceSwitch:"1",obdSwitch:"1",projectName:null,reportTemplates:null,status:null,orderType:null,evaluationMode:null},P.value.resetFields()},A=async s=>{if(!s)return;if(!await s.validate(t=>!!t))return!1;f.$modal.loading();try{const t={...r.value};t.detectionProtocolsId&&delete t.detectionProtocolsId,V.value==="add"?await W(t):await X(t),C.value.getList(),g.value=!1;const u=V.value==="add"?"新增项目":"编辑项目";f.$modal.msgSuccess(`${u}成功`)}catch(t){console.error("验证或请求失败:",t)}finally{f.$modal.closeLoading()}},j=async s=>{s!=="edit"&&(r.value.detectionProtocolsIds=[]),T.value=[];const{orderType:l,evaluationMode:t,version:u}=r.value;if(l&&t){const{code:m,data:i}=await Y({orderType:l,evaluationMode:t,version:u});m===200&&(T.value=i)}},O=()=>{g.value=!1};return ee(()=>{B()}),(s,l)=>{const t=p("dict-tag"),u=p("el-option"),m=p("el-select"),i=p("el-form-item"),z=p("el-input"),G=p("el-form"),k=p("el-button"),H=p("el-dialog");return d(),v("div",re,[a(o(J),{ref_key:"formTableRef",ref:C,"form-config":o(q),"table-columns":o(x),operations:L,showAdd:!0,api:o(K),onAdd:N,onOperation:U},{orderType:n(({row:e})=>[a(t,{options:o(h),value:e.orderType},null,8,["options","value"])]),status:n(({row:e})=>[a(t,{options:o(I),value:e.status},null,8,["options","value"])]),_:1},8,["form-config","table-columns","api"]),a(H,{title:o(V)==="add"?"新增项目":"编辑项目",modelValue:o(g),"onUpdate:modelValue":l[7]||(l[7]=e=>oe(g)?g.value=e:null),width:"500","close-on-click-modal":!1,onClose:S},{footer:n(()=>[le("span",ne,[a(k,{onClick:O},{default:n(()=>[F("取 消")]),_:1}),a(k,{type:"primary",onClick:l[6]||(l[6]=e=>A(o(P)))},{default:n(()=>[F("确 定")]),_:1})])]),default:n(()=>[a(G,{ref_key:"dialogFormRef",ref:P,model:o(r),rules:o(R),"label-width":"100px"},{default:n(()=>[a(i,{label:"企业名称",prop:"channelEnterpriseId"},{default:n(()=>[a(m,{modelValue:o(r).channelEnterpriseId,"onUpdate:modelValue":l[0]||(l[0]=e=>o(r).channelEnterpriseId=e),placeholder:"请选择企业名称",clearable:""},{default:n(()=>[(d(!0),v(b,null,_(o(w),e=>(d(),y(u,{key:e.channelEnterpriseId,label:e.enterpriseName,value:e.channelEnterpriseId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(i,{label:"项目名称",prop:"projectName"},{default:n(()=>[a(z,{modelValue:o(r).projectName,"onUpdate:modelValue":l[1]||(l[1]=e=>o(r).projectName=e),placeholder:"请输入项目名称",clearable:""},null,8,["modelValue"])]),_:1}),a(i,{label:"订单类型",prop:"orderType"},{default:n(()=>[a(m,{modelValue:o(r).orderType,"onUpdate:modelValue":l[2]||(l[2]=e=>o(r).orderType=e),placeholder:"请选择订单类型",onChange:j,clearable:""},{default:n(()=>[(d(!0),v(b,null,_(o(h),e=>(d(),y(u,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(i,{label:"评估模式",prop:"evaluationMode"},{default:n(()=>[a(m,{modelValue:o(r).evaluationMode,"onUpdate:modelValue":l[3]||(l[3]=e=>o(r).evaluationMode=e),placeholder:"请选择评估模式",onChange:j,clearable:""},{default:n(()=>[(d(!0),v(b,null,_(o(D),e=>(d(),y(u,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(i,{label:"检查方案",prop:"detectionProtocolsIds"},{default:n(()=>[a(m,{modelValue:o(r).detectionProtocolsIds,"onUpdate:modelValue":l[4]||(l[4]=e=>o(r).detectionProtocolsIds=e),placeholder:"请选择检查方案",multiple:"",clearable:""},{default:n(()=>[(d(!0),v(b,null,_(o(T),e=>(d(),y(u,{key:e.detectionProtocolsId,label:e.planName,value:e.detectionProtocolsId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(i,{label:"状态",prop:"status"},{default:n(()=>[a(m,{modelValue:o(r).status,"onUpdate:modelValue":l[5]||(l[5]=e=>o(r).status=e),placeholder:"请选择状态",clearable:""},{default:n(()=>[(d(!0),v(b,null,_(o(I),e=>(d(),y(u,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}}});export{fe as default};
