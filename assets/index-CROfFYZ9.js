import{P as w,_ as se,r as v,g as i,R as ue,o as d,c as b,f as a,w as t,h as g,S as B,l as h,i as L,x as ie,T as re,F as S,C as T,z as de,t as ce}from"./index-Bz8aCySx.js";function me(c){return w({url:"/product/assessment/list",method:"get",params:c})}function ve(c){return w({url:"/product/assessment/add-assessment",method:"post",data:c})}function pe(c){return w({url:"/product/assessment/edit-assessment",method:"put",data:c})}function ge(c){return w({url:`/product/assessment/del/${c}`,method:"delete"})}function fe(c){const{productAssessmentId:m,version:$}=c;let D=`/product/assessment/list/${m}`;return w({url:D,method:"get"})}const _e={class:"app-container evaluation"},ye=de({name:"Evaluation"}),be=Object.assign(ye,{setup(c){const{proxy:m}=ce(),{vehicle_structure:$,detection_type:D,damage_level:O}=m.useDict("vehicle_structure","detection_type","damage_level"),_=v({pageNum:1,pageSize:10,assessmentName:"",version:""}),y=v({assessmentName:"",version:""}),q=o=>{_.value={pageNum:1,pageSize:10,...o},V()},j=()=>{y.value={assessmentName:"",version:""},q(y.value)},M=()=>{A()},z=v([]),E=v(0),U=v(!1),Q=o=>{G(o)},G=async o=>{m.$modal.loading();try{const{productAssessmentId:l,version:u}=o,{code:r,data:s}=await fe({productAssessmentId:l,version:u});r===200&&s&&A(s)}finally{m.$modal.closeLoading()}},H=async o=>{const{productAssessmentId:l}=o;if(!await m.$modal.confirm("确认删除该评测项吗?").catch(()=>!1))return!1;m.$modal.loading();try{await ge(l),await V()}catch(r){console.error("删除失败:",r)}finally{m.$modal.closeLoading()}},C=v(!1),N=v("add"),n=v({vehicleStructure:"",assessmentName:"",detectionType:"",evaluationCriteriaList:[{damageDescription:"",damageLevel:""}],status:"0"}),x=v(null),J=v({vehicleStructure:[{required:!0,message:"请选择所属结构",trigger:"change"}],assessmentName:[{required:!0,message:"请输入评测项名称",trigger:"blur"}],detectionType:[{required:!0,message:"请选择检测类型",trigger:"change"}],evaluationCriteriaList:[{validator:(o,l,u)=>{if(!l.every(s=>s.damageDescription&&s.damageLevel))return u(new Error("每一组数据都要必填"));u()},trigger:"change"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]}),A=o=>{C.value=!0,o?(N.value="edit",n.value={...o}):N.value="add"},K=()=>{n.value={vehicleStructure:"",assessmentName:"",detectionType:"",evaluationCriteriaList:[{damageDescription:"",damageLevel:""}],status:"0"},x.value.resetFields()},W=()=>{C.value=!1},X=async o=>{if(!await o.validate(u=>!!u))return!1;m.$modal.loading();try{N.value==="add"?await ve(n.value):await pe(n.value),await V(),C.value=!1}catch(u){console.error("验证或请求失败:",u)}finally{m.$modal.closeLoading()}},Y=()=>{n.value.evaluationCriteriaList.push({damageDescription:"",damageLevel:""})},Z=o=>{n.value.evaluationCriteriaList.splice(o,1)},V=async()=>{console.log(123),U.value=!0;try{const{rows:o,total:l}=await me(_.value);z.value=o,E.value=l}catch(o){console.log(o)}finally{U.value=!1}};return V(),(o,l)=>{const u=i("el-input"),r=i("el-form-item"),s=i("el-button"),I=i("el-form"),f=i("el-table-column"),P=i("dict-tag"),ee=i("el-tag"),ae=i("el-table"),le=i("pagination"),F=i("el-option"),R=i("el-select"),te=i("el-switch"),oe=i("el-dialog"),ne=ue("loading");return d(),b("div",_e,[a(I,{model:y.value,inline:!0},{default:t(()=>[a(r,{label:"评测项名称"},{default:t(()=>[a(u,{modelValue:y.value.assessmentName,"onUpdate:modelValue":l[0]||(l[0]=e=>y.value.assessmentName=e),placeholder:"请输入评测项名称",clearable:"",style:{width:"240px"}},null,8,["modelValue"])]),_:1}),a(r,null,{default:t(()=>[a(s,{type:"primary",icon:"Search",onClick:l[1]||(l[1]=e=>q(y.value))},{default:t(()=>[g("查询")]),_:1}),a(s,{icon:"Refresh",onClick:j},{default:t(()=>[g("重置")]),_:1}),a(s,{type:"primary",icon:"Plus",onClick:M},{default:t(()=>[g("新增")]),_:1})]),_:1})]),_:1},8,["model"]),B((d(),h(ae,{data:z.value},{default:t(()=>[a(f,{type:"index",label:"序号",width:"50",align:"center"}),a(f,{prop:"vehicleStructure",label:"所属结构",align:"center"},{default:t(({row:e})=>[a(P,{options:L($),value:e.vehicleStructure},null,8,["options","value"])]),_:1}),a(f,{prop:"assessmentName",label:"评测项名称",align:"center"}),a(f,{prop:"detectionType",label:"评测项类型",align:"center"},{default:t(({row:e})=>[a(P,{options:L(D),value:e.detectionType},null,8,["options","value"])]),_:1}),a(f,{prop:"version",label:"产品版本",align:"center"}),a(f,{prop:"status",label:"状态",align:"center"},{default:t(({row:e})=>[a(ee,{type:e.status==="0"?"primary":"danger"},{default:t(()=>[g(ie(e.status==="0"?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),a(f,{label:"操作"},{default:t(({row:e})=>[a(s,{type:"primary",text:"",onClick:k=>Q(e)},{default:t(()=>[g("编辑")]),_:2},1032,["onClick"]),a(s,{type:"danger",text:"",onClick:k=>H(e)},{default:t(()=>[g("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ne,U.value]]),B(a(le,{total:E.value,page:_.value.pageNum,"onUpdate:page":l[2]||(l[2]=e=>_.value.pageNum=e),limit:_.value.pageSize,"onUpdate:limit":l[3]||(l[3]=e=>_.value.pageSize=e),onPagination:V},null,8,["total","page","limit"]),[[re,E.value>0]]),a(oe,{title:N.value==="add"?"新增评测项":"编辑评测项",modelValue:C.value,"onUpdate:modelValue":l[9]||(l[9]=e=>C.value=e),width:"500","close-on-click-modal":!1,onClose:K},{footer:t(()=>[a(s,{onClick:W},{default:t(()=>[g("取 消")]),_:1}),a(s,{type:"primary",onClick:l[8]||(l[8]=e=>X(x.value))},{default:t(()=>[g("确 定")]),_:1})]),default:t(()=>[a(I,{model:n.value,ref_key:"dialogFormRef",ref:x,rules:J.value,"label-width":"100px"},{default:t(()=>[a(r,{label:"所属结构",prop:"vehicleStructure"},{default:t(()=>[a(R,{modelValue:n.value.vehicleStructure,"onUpdate:modelValue":l[4]||(l[4]=e=>n.value.vehicleStructure=e),placeholder:"请选择所属结构",clearable:""},{default:t(()=>[(d(!0),b(S,null,T(L($),e=>(d(),h(F,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(r,{label:"评测项名称",prop:"assessmentName"},{default:t(()=>[a(u,{modelValue:n.value.assessmentName,"onUpdate:modelValue":l[5]||(l[5]=e=>n.value.assessmentName=e),placeholder:"请输入评测项名称",clearable:""},null,8,["modelValue"])]),_:1}),a(r,{label:"检测类型",prop:"detectionType"},{default:t(()=>[a(R,{modelValue:n.value.detectionType,"onUpdate:modelValue":l[6]||(l[6]=e=>n.value.detectionType=e),placeholder:"请选择检测类型",clearable:""},{default:t(()=>[(d(!0),b(S,null,T(L(D),e=>(d(),h(F,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(r,{label:"评测标准",prop:"evaluationCriteriaList"},{default:t(()=>[(d(!0),b(S,null,T(n.value.evaluationCriteriaList,(e,k)=>(d(),b("div",{class:"item-evaluations",key:k},[a(u,{class:"evaluations-input",modelValue:e.damageDescription,"onUpdate:modelValue":p=>e.damageDescription=p,placeholder:"请输入评测标准",clearable:""},null,8,["modelValue","onUpdate:modelValue"]),a(R,{class:"evaluations-select",modelValue:e.damageLevel,"onUpdate:modelValue":p=>e.damageLevel=p,placeholder:"请选择",clearable:""},{default:t(()=>[(d(!0),b(S,null,T(L(O),p=>(d(),h(F,{key:p.value,label:p.label,value:p.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]),k>0?(d(),h(s,{key:0,type:"danger",icon:"Minus",circle:"",onClick:p=>Z(k)},null,8,["onClick"])):(d(),h(s,{key:1,type:"primary",icon:"Plus",circle:"",onClick:Y}))]))),128))]),_:1}),a(r,{label:"状态",prop:"status"},{default:t(()=>[a(te,{modelValue:n.value.status,"onUpdate:modelValue":l[7]||(l[7]=e=>n.value.status=e),"active-value":"0","inactive-value":"1"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}}}),Ve=se(be,[["__scopeId","data-v-9418c459"]]);export{Ve as default};
